{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/lib/db.js"],"sourcesContent":["// src/lib/db.js\nimport mysql from \"mysql2/promise\"\n\nlet pool = null\n\nfunction getConfig() {\n  const host = process.env.DB_HOST ?? \"127.0.0.1\"\n  const port = Number.parseInt(process.env.DB_PORT ?? \"3307\", 10)\n  const user = process.env.DB_USER ?? \"drone_user\"\n  const password = process.env.DB_PASSWORD ?? \"dronepwd\"\n  const database = process.env.DB_NAME ?? \"drone_sop\"\n\n  return {\n    host,\n    port: Number.isNaN(port) ? 3307 : port,\n    user,\n    password,\n    database,\n  }\n}\n\nexport function getPool() {\n  if (!pool) {\n    const config = getConfig()\n    pool = mysql.createPool({\n      ...config,\n      waitForConnections: true,\n      connectionLimit: 10,\n      // ✅ 한국시간 (UTC+9)\n      timezone: \"+09:00\",\n    })\n  }\n  return pool\n}\n\nexport async function runQuery(sql, params = []) {\n  const currentPool = getPool()\n  const [rows] = await currentPool.query(sql, params)\n  return rows\n}\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;AAChB;;AAEA,IAAI,OAAO;AAEX,SAAS;IACP,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,MAAM,OAAO,OAAO,QAAQ,CAAC,QAAQ,GAAG,CAAC,OAAO,IAAI,QAAQ;IAC5D,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,MAAM,WAAW,QAAQ,GAAG,CAAC,WAAW,IAAI;IAC5C,MAAM,WAAW,QAAQ,GAAG,CAAC,OAAO,IAAI;IAExC,OAAO;QACL;QACA,MAAM,OAAO,KAAK,CAAC,QAAQ,OAAO;QAClC;QACA;QACA;IACF;AACF;AAEO,SAAS;IACd,IAAI,CAAC,MAAM;QACT,MAAM,SAAS;QACf,OAAO,8MAAK,CAAC,UAAU,CAAC;YACtB,GAAG,MAAM;YACT,oBAAoB;YACpB,iBAAiB;YACjB,iBAAiB;YACjB,UAAU;QACZ;IACF;IACA,OAAO;AACT;AAEO,eAAe,SAAS,GAAG,EAAE,SAAS,EAAE;IAC7C,MAAM,cAAc;IACpB,MAAM,CAAC,KAAK,GAAG,MAAM,YAAY,KAAK,CAAC,KAAK;IAC5C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/components/data-table/utils/constants.js"],"sourcesContent":["// src/features/line-dashboard/components/data-table/utils/constants.js\n// 데이터 테이블 전역에서 재사용하는 상수와 포맷터들입니다.\nexport const DEFAULT_TABLE = \"drone_sop_v3\"\nexport const DEFAULT_RANGE_DAYS = 3\n\nconst DAY_IN_MS = 86_400_000\n\n// Date 객체를 YYYY-MM-DD 문자열로 바꿔 폼 입력과 호환되게 만듭니다.\nexport const toDateInputValue = (date) => date.toISOString().split(\"T\")[0]\n\nexport const getDefaultFromValue = () => {\n  const now = new Date()\n  const from = new Date(now.getTime() - DEFAULT_RANGE_DAYS * DAY_IN_MS)\n  return toDateInputValue(from)\n}\n\nexport const getDefaultToValue = () => toDateInputValue(new Date())\n\n// 셀 저장 인디케이터 노출 시간을 제어하는 값들입니다.\nexport const SAVING_DELAY_MS = 180\nexport const MIN_SAVING_VISIBLE_MS = 500\nexport const SAVED_VISIBLE_MS = 800\n\n// 프로세스 플로우와 관련된 컬럼 키 목록입니다.\nexport const STEP_COLUMN_KEYS = [\n  \"main_step\",\n  \"metro_steps\",\n  \"metro_current_step\",\n  \"metro_end_step\",\n  \"custom_end_step\",\n  \"inform_step\",\n]\n\nexport const STEP_COLUMN_KEY_SET = new Set(STEP_COLUMN_KEYS)\n\n// UI 표시에 사용할 공통 숫자/시간 포맷터입니다.\nexport const numberFormatter = new Intl.NumberFormat(\"en-US\")\nexport const timeFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n  second: \"2-digit\",\n})\n"],"names":[],"mappings":"AAAA,uEAAuE;AACvE,kCAAkC;;;;;;;;;;;;;;;;;;;;;;;;;;;AAC3B,MAAM,gBAAgB;AACtB,MAAM,qBAAqB;AAElC,MAAM,YAAY;AAGX,MAAM,mBAAmB,CAAC,OAAS,KAAK,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;AAEnE,MAAM,sBAAsB;IACjC,MAAM,MAAM,IAAI;IAChB,MAAM,OAAO,IAAI,KAAK,IAAI,OAAO,KAAK,qBAAqB;IAC3D,OAAO,iBAAiB;AAC1B;AAEO,MAAM,oBAAoB,IAAM,iBAAiB,IAAI;AAGrD,MAAM,kBAAkB;AACxB,MAAM,wBAAwB;AAC9B,MAAM,mBAAmB;AAGzB,MAAM,mBAAmB;IAC9B;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,sBAAsB,IAAI,IAAI;AAGpC,MAAM,kBAAkB,IAAI,KAAK,YAAY,CAAC;AAC9C,MAAM,gBAAgB,IAAI,KAAK,cAAc,CAAC,SAAS;IAC5D,MAAM;IACN,QAAQ;IACR,QAAQ;AACV","debugId":null}},
    {"offset": {"line": 224, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/app/api/tables/update/route.js"],"sourcesContent":["// src/app/api/tables/update/route.js\nimport { NextResponse } from \"next/server\"\n\nimport { getPool, runQuery } from \"@/lib/db\"\nimport { DEFAULT_TABLE } from \"@/features/line-dashboard/components/data-table/utils/constants\"\n\nconst SAFE_IDENTIFIER = /^[A-Za-z0-9_]+$/\nconst ALLOWED_UPDATE_COLUMNS = new Set([\"comment\", \"needtosend\"])\n\nfunction sanitizeIdentifier(value, fallback = null) {\n  if (typeof value !== \"string\") return fallback\n  const trimmed = value.trim()\n  if (!SAFE_IDENTIFIER.test(trimmed)) return fallback\n  return trimmed\n}\n\nfunction findColumn(columnNames, target) {\n  const targetLower = target.toLowerCase()\n  for (const name of columnNames) {\n    if (typeof name !== \"string\") continue\n    if (name.toLowerCase() === targetLower) return name\n  }\n  return null\n}\n\nfunction normalizeUpdateValue(key, value) {\n  if (key === \"comment\") {\n    if (value === null || value === undefined) return \"\"\n    return String(value)\n  }\n  if (key === \"needtosend\") {\n    const numeric = Number(value)\n    if (!Number.isFinite(numeric)) return 0\n    return numeric === 0 ? 0 : 1\n  }\n  return value\n}\n\nexport async function PATCH(request) {\n  let payload\n  try {\n    payload = await request.json()\n  } catch {\n    return NextResponse.json({ error: \"Invalid JSON body\" }, { status: 400 })\n  }\n\n  const tableName = sanitizeIdentifier(payload?.table, DEFAULT_TABLE)\n  const recordId = payload?.id\n  const updates = payload?.updates\n\n  if (recordId === null || recordId === undefined || (typeof recordId === \"string\" && recordId.trim().length === 0)) {\n    return NextResponse.json({ error: \"Record id is required\" }, { status: 400 })\n  }\n\n  if (!updates || typeof updates !== \"object\" || Array.isArray(updates)) {\n    return NextResponse.json({ error: \"Updates must be an object\" }, { status: 400 })\n  }\n\n  const filteredEntries = Object.entries(updates).filter(\n    ([key, value]) => ALLOWED_UPDATE_COLUMNS.has(key) && value !== undefined\n  )\n\n  if (filteredEntries.length === 0) {\n    return NextResponse.json({ error: \"No valid updates provided\" }, { status: 400 })\n  }\n\n  try {\n    const columnRows = await runQuery(`SHOW COLUMNS FROM \\`${tableName}\\``)\n    const columnNames = columnRows\n      .map((column) => column?.Field)\n      .filter((value) => typeof value === \"string\")\n\n    const idColumn = findColumn(columnNames, \"id\")\n    if (!idColumn) {\n      return NextResponse.json({ error: `Table \"${tableName}\" does not expose an id column` }, { status: 400 })\n    }\n\n    const assignments = []\n    const params = []\n\n    for (const [key, value] of filteredEntries) {\n      const columnName = findColumn(columnNames, key)\n      if (!columnName) continue\n      assignments.push(`\\`${columnName}\\` = ?`)\n      params.push(normalizeUpdateValue(key, value))\n    }\n\n    if (assignments.length === 0) {\n      return NextResponse.json({ error: \"No matching columns to update\" }, { status: 400 })\n    }\n\n    params.push(recordId)\n\n    const pool = getPool()\n    const [result] = await pool.execute(\n      `\n        UPDATE \\`${tableName}\\`\n        SET ${assignments.join(\", \")}\n        WHERE \\`${idColumn}\\` = ?\n        LIMIT 1\n      `,\n      params\n    )\n\n    if (result?.affectedRows === 0) {\n      return NextResponse.json({ error: \"Record not found\" }, { status: 404 })\n    }\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    if (error && typeof error === \"object\" && error.code === \"ER_NO_SUCH_TABLE\") {\n      return NextResponse.json({ error: `Table \"${tableName}\" was not found` }, { status: 404 })\n    }\n\n    console.error(\"Failed to update table record\", error)\n    return NextResponse.json({ error: \"Failed to update record\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}