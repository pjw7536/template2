{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/app/api/mock-oidc/store.js"],"sourcesContent":["// src/app/api/mock-oidc/store.js\nconst issuedCodes = new Map()\n\nexport function saveAuthCode(code, payload) {\n  if (!code) return\n  issuedCodes.set(code, { ...payload, createdAt: Date.now() })\n}\n\nexport function consumeAuthCode(code) {\n  if (!code) return null\n  const payload = issuedCodes.get(code)\n  issuedCodes.delete(code)\n  return payload ?? null\n}\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;;;AACjC,MAAM,cAAc,IAAI;AAEjB,SAAS,aAAa,IAAI,EAAE,OAAO;IACxC,IAAI,CAAC,MAAM;IACX,YAAY,GAAG,CAAC,MAAM;QAAE,GAAG,OAAO;QAAE,WAAW,KAAK,GAAG;IAAG;AAC5D;AAEO,SAAS,gBAAgB,IAAI;IAClC,IAAI,CAAC,MAAM,OAAO;IAClB,MAAM,UAAU,YAAY,GAAG,CAAC;IAChC,YAAY,MAAM,CAAC;IACnB,OAAO,WAAW;AACpB","debugId":null}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/app/api/mock-oidc/token/route.js"],"sourcesContent":["// src/app/api/mock-oidc/token/route.js\nimport crypto from \"node:crypto\"\n\nimport { consumeAuthCode } from \"../store\"\n\nconst DEFAULT_USER = {\n  sub: \"demo-user\",\n  name: \"Demo User\",\n  preferred_username: \"demo\",\n  email: \"demo.user@example.com\",\n  picture: \"https://avatars.githubusercontent.com/u/9919?v=4\",\n}\n\nconst DEFAULT_SCOPE = \"openid profile email\"\n\nfunction resolveIssuer() {\n  const envIssuer = process.env.AUTH_OIDC_ISSUER?.trim()\n  if (envIssuer) return envIssuer.replace(/\\/$/, \"\")\n  const url = process.env.NEXTAUTH_URL?.replace(/\\/$/, \"\")\n  if (url) return `${url}/api/mock-oidc`\n  return \"http://localhost:3000/api/mock-oidc\"\n}\n\nasync function parseBody(request) {\n  const contentType = request.headers.get(\"content-type\") || \"\"\n  if (contentType.includes(\"application/json\")) {\n    return request.json()\n  }\n  const formData = await request.formData()\n  const result = {}\n  for (const [key, value] of formData.entries()) {\n    result[key] = value\n  }\n  return result\n}\n\nfunction base64UrlEncode(input) {\n  const buffer =\n    typeof input === \"string\" || input instanceof Buffer\n      ? Buffer.from(input)\n      : Buffer.from(JSON.stringify(input))\n  return buffer\n    .toString(\"base64\")\n    .replace(/=/g, \"\")\n    .replace(/\\+/g, \"-\")\n    .replace(/\\//g, \"_\")\n}\n\nfunction createIdToken({ issuer, audience, nonce, now, clientSecret }) {\n  const payload = {\n    iss: issuer,\n    aud: audience,\n    sub: DEFAULT_USER.sub,\n    name: DEFAULT_USER.name,\n    email: DEFAULT_USER.email,\n    email_verified: true,\n    preferred_username: DEFAULT_USER.preferred_username,\n    picture: DEFAULT_USER.picture,\n    iat: now,\n    exp: now + 3600,\n    auth_time: now,\n  }\n\n  if (nonce) {\n    payload.nonce = nonce\n  }\n\n  const headerSegment = base64UrlEncode({ alg: \"HS256\", typ: \"JWT\" })\n  const payloadSegment = base64UrlEncode(payload)\n  const signingInput = `${headerSegment}.${payloadSegment}`\n  const signature = crypto.createHmac(\"sha256\", clientSecret).update(signingInput).digest(\"base64\")\n  const signatureSegment = signature.replace(/=/g, \"\").replace(/\\+/g, \"-\").replace(/\\//g, \"_\")\n  return `${signingInput}.${signatureSegment}`\n}\n\nfunction parseClientCredentials(request, body, fallbackClientId) {\n  const defaultClientId = process.env.AUTH_OIDC_ID ?? \"demo-client\"\n  const defaultClientSecret = process.env.AUTH_OIDC_SECRET ?? \"demo-secret\"\n\n  const header = request.headers.get(\"authorization\") || \"\"\n  if (header.startsWith(\"Basic \")) {\n    const encoded = header.slice(\"Basic \".length)\n    const decoded = Buffer.from(encoded, \"base64\").toString(\"utf8\")\n    const separatorIndex = decoded.indexOf(\":\")\n    if (separatorIndex >= 0) {\n      const clientId = decoded.slice(0, separatorIndex) || defaultClientId\n      const clientSecret = decoded.slice(separatorIndex + 1) || defaultClientSecret\n      return { clientId, clientSecret }\n    }\n  }\n\n  return {\n    clientId: body.client_id || fallbackClientId || defaultClientId,\n    clientSecret: body.client_secret || defaultClientSecret,\n  }\n}\n\nexport async function POST(request) {\n  const body = await parseBody(request)\n  const issuedCode = consumeAuthCode(body.code)\n  const { clientId, clientSecret } = parseClientCredentials(request, body, issuedCode?.clientId)\n\n  const issuer = resolveIssuer()\n  const now = Math.floor(Date.now() / 1000)\n\n  const idToken = createIdToken({\n    issuer,\n    audience: clientId,\n    nonce: issuedCode?.nonce || null,\n    now,\n    clientSecret,\n  })\n\n  return Response.json({\n    access_token: \"mock-access-token\",\n    token_type: \"Bearer\",\n    expires_in: 3600,\n    refresh_token: \"mock-refresh-token\",\n    scope: issuedCode?.scope || body.scope || DEFAULT_SCOPE,\n    issued_at: now,\n    id_token: idToken,\n  })\n}\n\nexport const GET = POST\n"],"names":[],"mappings":"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","debugId":null}}]
}