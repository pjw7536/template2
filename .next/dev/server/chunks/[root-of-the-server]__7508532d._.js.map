{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/lib/db.js"],"sourcesContent":["// src/lib/db.js\nimport mysql from \"mysql2/promise\"\n\nlet pool = null\n\nfunction getConfig() {\n  const host = process.env.DB_HOST ?? \"127.0.0.1\"\n  const port = Number.parseInt(process.env.DB_PORT ?? \"3307\", 10)\n  const user = process.env.DB_USER ?? \"drone_user\"\n  const password = process.env.DB_PASSWORD ?? \"dronepwd\"\n  const database = process.env.DB_NAME ?? \"drone_sop\"\n\n  return {\n    host,\n    port: Number.isNaN(port) ? 3307 : port,\n    user,\n    password,\n    database,\n  }\n}\n\nexport function getPool() {\n  if (!pool) {\n    const config = getConfig()\n    pool = mysql.createPool({\n      ...config,\n      waitForConnections: true,\n      connectionLimit: 10,\n      // ✅ 한국시간 (UTC+9)\n      timezone: \"+09:00\",\n    })\n  }\n  return pool\n}\n\nexport async function runQuery(sql, params = []) {\n  const currentPool = getPool()\n  const [rows] = await currentPool.query(sql, params)\n  return rows\n}\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;AAChB;;AAEA,IAAI,OAAO;AAEX,SAAS;IACP,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,MAAM,OAAO,OAAO,QAAQ,CAAC,QAAQ,GAAG,CAAC,OAAO,IAAI,QAAQ;IAC5D,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,MAAM,WAAW,QAAQ,GAAG,CAAC,WAAW,IAAI;IAC5C,MAAM,WAAW,QAAQ,GAAG,CAAC,OAAO,IAAI;IAExC,OAAO;QACL;QACA,MAAM,OAAO,KAAK,CAAC,QAAQ,OAAO;QAClC;QACA;QACA;IACF;AACF;AAEO,SAAS;IACd,IAAI,CAAC,MAAM;QACT,MAAM,SAAS;QACf,OAAO,8MAAK,CAAC,UAAU,CAAC;YACtB,GAAG,MAAM;YACT,oBAAoB;YACpB,iBAAiB;YACjB,iBAAiB;YACjB,UAAU;QACZ;IACF;IACA,OAAO;AACT;AAEO,eAAe,SAAS,GAAG,EAAE,SAAS,EAAE;IAC7C,MAAM,cAAc;IACpB,MAAM,CAAC,KAAK,GAAG,MAAM,YAAY,KAAK,CAAC,KAAK;IAC5C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/app/api/drone-early-inform/route.js"],"sourcesContent":["// src/app/api/drone-early-inform/route.js\nimport { NextResponse } from \"next/server\"\n\nimport { getPool, runQuery } from \"@/lib/db\"\n\nconst TABLE_NAME = \"drone_early_inform_v3\"\nconst MAX_FIELD_LENGTH = 50\n\nfunction sanitizeLineId(value) {\n  if (typeof value !== \"string\") return null\n  const trimmed = value.trim()\n  if (trimmed.length === 0) return null\n  if (trimmed.length > MAX_FIELD_LENGTH) return null\n  return trimmed\n}\n\nfunction sanitizeMainStep(value) {\n  if (typeof value !== \"string\") value = value === null || value === undefined ? \"\" : String(value)\n  const trimmed = value.trim()\n  if (trimmed.length === 0) return null\n  if (trimmed.length > MAX_FIELD_LENGTH) return null\n  return trimmed\n}\n\nfunction normalizeCustomEndStep(value) {\n  if (value === undefined) {\n    return { hasValue: false, value: null }\n  }\n  if (value === null) {\n    return { hasValue: true, value: null }\n  }\n  const stringified = typeof value === \"string\" ? value : String(value)\n  const trimmed = stringified.trim()\n  if (trimmed.length === 0) {\n    return { hasValue: true, value: null }\n  }\n  if (trimmed.length > MAX_FIELD_LENGTH) {\n    throw new Error(\"customEndStep must be 50 characters or fewer\")\n  }\n  return { hasValue: true, value: trimmed }\n}\n\nfunction mapRow(row) {\n  if (!row || typeof row !== \"object\") return null\n  const { id, line_id: lineId, main_step: mainStep, custom_end_step: customEndStep } = row\n  if (id === null || id === undefined) return null\n  return {\n    id: Number(id),\n    lineId: typeof lineId === \"string\" ? lineId : null,\n    mainStep: typeof mainStep === \"string\" ? mainStep : mainStep === null || mainStep === undefined ? \"\" : String(mainStep),\n    customEndStep:\n      customEndStep === null || customEndStep === undefined\n        ? null\n        : typeof customEndStep === \"string\"\n          ? customEndStep\n          : String(customEndStep),\n  }\n}\n\nfunction toJsonError(message, status = 400) {\n  return NextResponse.json({ error: message }, { status })\n}\n\nexport async function GET(request) {\n  const url = new URL(request.url)\n  const rawLineId = url.searchParams.get(\"lineId\")\n  const lineId = sanitizeLineId(rawLineId)\n\n  if (!lineId) {\n    return toJsonError(\"lineId is required\", 400)\n  }\n\n  try {\n    const rows = await runQuery(\n      `\n        SELECT id, line_id, main_step, custom_end_step\n        FROM \\`${TABLE_NAME}\\`\n        WHERE line_id = ?\n        ORDER BY main_step ASC, id ASC\n      `,\n      [lineId]\n    )\n\n    const normalized = rows\n      .map(mapRow)\n      .filter((row) => row !== null)\n      .map((row) => ({\n        ...row,\n        lineId: row.lineId ?? lineId,\n      }))\n\n    return NextResponse.json({\n      lineId,\n      rowCount: normalized.length,\n      rows: normalized,\n    })\n  } catch (error) {\n    console.error(\"Failed to load drone_early_inform_v3 rows\", error)\n    return toJsonError(\"Failed to load settings\", 500)\n  }\n}\n\nexport async function POST(request) {\n  let payload\n  try {\n    payload = await request.json()\n  } catch {\n    return toJsonError(\"Invalid JSON body\", 400)\n  }\n\n  const lineId = sanitizeLineId(payload?.lineId)\n  const mainStep = sanitizeMainStep(payload?.mainStep)\n\n  if (!lineId) {\n    return toJsonError(\"lineId is required\", 400)\n  }\n  if (!mainStep) {\n    return toJsonError(\"mainStep is required\", 400)\n  }\n\n  let customEndStep\n  try {\n    customEndStep = normalizeCustomEndStep(payload?.customEndStep).value\n  } catch (error) {\n    const message = error instanceof Error ? error.message : \"Invalid customEndStep\"\n    return toJsonError(message, 400)\n  }\n\n  try {\n    const pool = getPool()\n    const [result] = await pool.execute(\n      `\n        INSERT INTO \\`${TABLE_NAME}\\` (line_id, main_step, custom_end_step)\n        VALUES (?, ?, ?)\n      `,\n      [lineId, mainStep, customEndStep]\n    )\n\n    const entry = {\n      id: Number(result?.insertId ?? 0),\n      lineId,\n      mainStep,\n      customEndStep,\n    }\n\n    return NextResponse.json({ entry }, { status: 201 })\n  } catch (error) {\n    if (error && typeof error === \"object\" && \"code\" in error && error.code === \"ER_DUP_ENTRY\") {\n      return toJsonError(\"An entry for this main step already exists\", 409)\n    }\n\n    console.error(\"Failed to insert drone_early_inform_v3 row\", error)\n    return toJsonError(\"Failed to create entry\", 500)\n  }\n}\n\nexport async function PATCH(request) {\n  let payload\n  try {\n    payload = await request.json()\n  } catch {\n    return toJsonError(\"Invalid JSON body\", 400)\n  }\n\n  const rawId = payload?.id\n  const idNumber = Number.parseInt(rawId, 10)\n  if (!Number.isFinite(idNumber) || idNumber <= 0) {\n    return toJsonError(\"A valid id is required\", 400)\n  }\n\n  const updates = []\n  const params = []\n\n  if (Object.prototype.hasOwnProperty.call(payload, \"mainStep\")) {\n    const nextMainStep = sanitizeMainStep(payload?.mainStep)\n    if (!nextMainStep) {\n      return toJsonError(\"mainStep is required\", 400)\n    }\n    updates.push(\"`main_step` = ?\")\n    params.push(nextMainStep)\n  }\n\n  if (Object.prototype.hasOwnProperty.call(payload, \"customEndStep\")) {\n    let normalized\n    try {\n      normalized = normalizeCustomEndStep(payload?.customEndStep)\n    } catch (error) {\n      const message = error instanceof Error ? error.message : \"Invalid customEndStep\"\n      return toJsonError(message, 400)\n    }\n    if (normalized.hasValue) {\n      updates.push(\"`custom_end_step` = ?\")\n      params.push(normalized.value)\n    }\n  }\n\n  if (updates.length === 0) {\n    return toJsonError(\"No valid fields to update\", 400)\n  }\n\n  params.push(idNumber)\n\n  try {\n    const pool = getPool()\n    const [result] = await pool.execute(\n      `\n        UPDATE \\`${TABLE_NAME}\\`\n        SET ${updates.join(\", \")}\n        WHERE id = ?\n        LIMIT 1\n      `,\n      params\n    )\n\n    if (!result || result.affectedRows === 0) {\n      return toJsonError(\"Entry not found\", 404)\n    }\n\n    const rows = await runQuery(\n      `\n        SELECT id, line_id, main_step, custom_end_step\n        FROM \\`${TABLE_NAME}\\`\n        WHERE id = ?\n        LIMIT 1\n      `,\n      [idNumber]\n    )\n\n    const entry = mapRow(rows[0])\n    if (!entry) {\n      return toJsonError(\"Entry not found\", 404)\n    }\n\n    return NextResponse.json({ entry })\n  } catch (error) {\n    if (error && typeof error === \"object\" && \"code\" in error && error.code === \"ER_DUP_ENTRY\") {\n      return toJsonError(\"An entry for this main step already exists\", 409)\n    }\n\n    console.error(\"Failed to update drone_early_inform_v3 row\", error)\n    return toJsonError(\"Failed to update entry\", 500)\n  }\n}\n\nexport async function DELETE(request) {\n  const url = new URL(request.url)\n  const rawId = url.searchParams.get(\"id\")\n  const idNumber = Number.parseInt(rawId ?? \"\", 10)\n\n  if (!Number.isFinite(idNumber) || idNumber <= 0) {\n    return toJsonError(\"A valid id is required\", 400)\n  }\n\n  try {\n    const pool = getPool()\n    const [result] = await pool.execute(\n      `\n        DELETE FROM \\`${TABLE_NAME}\\`\n        WHERE id = ?\n        LIMIT 1\n      `,\n      [idNumber]\n    )\n\n    if (!result || result.affectedRows === 0) {\n      return toJsonError(\"Entry not found\", 404)\n    }\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error(\"Failed to delete drone_early_inform_v3 row\", error)\n    return toJsonError(\"Failed to delete entry\", 500)\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}