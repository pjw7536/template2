{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/lib/db.js"],"sourcesContent":["import mysql from \"mysql2/promise\"\n\nlet pool = null\n\nfunction getConfig() {\n  const host = process.env.DB_HOST ?? \"127.0.0.1\"\n  const port = Number.parseInt(process.env.DB_PORT ?? \"3307\", 10)\n  const user = process.env.DB_USER ?? \"drone_user\"\n  const password = process.env.DB_PASSWORD ?? \"dronepwd\"\n  const database = process.env.DB_NAME ?? \"drone_sop\"\n\n  return {\n    host,\n    port: Number.isNaN(port) ? 3307 : port,\n    user,\n    password,\n    database,\n  }\n}\n\nexport function getPool() {\n  if (!pool) {\n    const config = getConfig()\n    pool = mysql.createPool({\n      ...config,\n      waitForConnections: true,\n      connectionLimit: 10,\n      // ✅ 한국시간 (UTC+9)\n      timezone: \"+09:00\",\n    })\n  }\n  return pool\n}\n\nexport async function runQuery(sql, params = []) {\n  const currentPool = getPool()\n  const [rows] = await currentPool.query(sql, params)\n  return rows\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,OAAO;AAEX,SAAS;IACP,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,MAAM,OAAO,OAAO,QAAQ,CAAC,QAAQ,GAAG,CAAC,OAAO,IAAI,QAAQ;IAC5D,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,MAAM,WAAW,QAAQ,GAAG,CAAC,WAAW,IAAI;IAC5C,MAAM,WAAW,QAAQ,GAAG,CAAC,OAAO,IAAI;IAExC,OAAO;QACL;QACA,MAAM,OAAO,KAAK,CAAC,QAAQ,OAAO;QAClC;QACA;QACA;IACF;AACF;AAEO,SAAS;IACd,IAAI,CAAC,MAAM;QACT,MAAM,SAAS;QACf,OAAO,8MAAK,CAAC,UAAU,CAAC;YACtB,GAAG,MAAM;YACT,oBAAoB;YACpB,iBAAiB;YACjB,iBAAiB;YACjB,UAAU;QACZ;IACF;IACA,OAAO;AACT;AAEO,eAAe,SAAS,GAAG,EAAE,SAAS,EAAE;IAC7C,MAAM,cAAc;IACpB,MAAM,CAAC,KAAK,GAAG,MAAM,YAAY,KAAK,CAAC,KAAK;IAC5C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 163, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/components/data-table/constants.js"],"sourcesContent":["export const DEFAULT_TABLE = \"drone_sop_v3\"\nexport const DEFAULT_RANGE_DAYS = 3\n\nconst DAY_IN_MS = 86_400_000\n\nexport const toDateInputValue = (date) => date.toISOString().split(\"T\")[0]\n\nexport const getDefaultFromValue = () => {\n  const now = new Date()\n  const from = new Date(now.getTime() - DEFAULT_RANGE_DAYS * DAY_IN_MS)\n  return toDateInputValue(from)\n}\n\nexport const getDefaultToValue = () => toDateInputValue(new Date())\n\nexport const SAVING_DELAY_MS = 180\nexport const MIN_SAVING_VISIBLE_MS = 500\nexport const SAVED_VISIBLE_MS = 800\n\nexport const STEP_COLUMN_KEYS = [\n  \"main_step\",\n  \"metro_steps\",\n  \"metro_current_step\",\n  \"metro_end_step\",\n  \"custom_end_step\",\n  \"inform_step\",\n]\n\nexport const STEP_COLUMN_KEY_SET = new Set(STEP_COLUMN_KEYS)\n\nexport const numberFormatter = new Intl.NumberFormat(\"en-US\")\nexport const timeFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n  second: \"2-digit\",\n})\n\nexport const dateFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  year: \"numeric\",\n  month: \"2-digit\",\n  day: \"2-digit\",\n})\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAO,MAAM,gBAAgB;AACtB,MAAM,qBAAqB;AAElC,MAAM,YAAY;AAEX,MAAM,mBAAmB,CAAC,OAAS,KAAK,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;AAEnE,MAAM,sBAAsB;IACjC,MAAM,MAAM,IAAI;IAChB,MAAM,OAAO,IAAI,KAAK,IAAI,OAAO,KAAK,qBAAqB;IAC3D,OAAO,iBAAiB;AAC1B;AAEO,MAAM,oBAAoB,IAAM,iBAAiB,IAAI;AAErD,MAAM,kBAAkB;AACxB,MAAM,wBAAwB;AAC9B,MAAM,mBAAmB;AAEzB,MAAM,mBAAmB;IAC9B;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,sBAAsB,IAAI,IAAI;AAEpC,MAAM,kBAAkB,IAAI,KAAK,YAAY,CAAC;AAC9C,MAAM,gBAAgB,IAAI,KAAK,cAAc,CAAC,SAAS;IAC5D,MAAM;IACN,QAAQ;IACR,QAAQ;AACV;AAEO,MAAM,gBAAgB,IAAI,KAAK,cAAc,CAAC,SAAS;IAC5D,MAAM;IACN,OAAO;IACP,KAAK;AACP","debugId":null}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/app/api/tables/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\"\n\nimport { runQuery } from \"@/lib/db\"\nimport { DEFAULT_TABLE } from \"@/features/line-dashboard/components/data-table/constants\"\n\nconst SAFE_IDENTIFIER = /^[A-Za-z0-9_]+$/\nconst DATE_ONLY_REGEX = /^\\d{4}-\\d{2}-\\d{2}$/\nconst ROW_LIMIT = 500\nconst DATE_COLUMN_CANDIDATES = [\"updated_at\", \"created_at\", \"timestamp\", \"ts\", \"date\"]\nconst LINE_SDWT_TABLE_NAME = \"line_sdwt\"\n\nfunction sanitizeIdentifier(value, fallback = null) {\n  if (typeof value !== \"string\") return fallback\n  const trimmed = value.trim()\n  if (!SAFE_IDENTIFIER.test(trimmed)) return fallback\n  return trimmed\n}\n\nfunction normalizeDateOnly(value) {\n  if (typeof value !== \"string\") return null\n  const trimmed = value.trim()\n  if (!DATE_ONLY_REGEX.test(trimmed)) return null\n  const parsed = new Date(`${trimmed}T00:00:00Z`)\n  if (Number.isNaN(parsed.getTime())) return null\n  return trimmed\n}\n\nfunction findColumn(columnNames, target) {\n  const targetLower = target.toLowerCase()\n  for (const name of columnNames) {\n    if (typeof name !== \"string\") continue\n    if (name.toLowerCase() === targetLower) return name\n  }\n  return null\n}\n\nexport async function GET(request) {\n  const url = new URL(request.url)\n  const searchParams = url.searchParams\n\n  const tableParam = searchParams.get(\"table\")\n  const fromParam = searchParams.get(\"from\")\n  const toParam = searchParams.get(\"to\")\n  const lineIdParam = searchParams.get(\"lineId\")\n\n  const tableName = sanitizeIdentifier(tableParam, DEFAULT_TABLE)\n  let normalizedFrom = normalizeDateOnly(fromParam)\n  let normalizedTo = normalizeDateOnly(toParam)\n  const normalizedLineId =\n    typeof lineIdParam === \"string\" && lineIdParam.trim().length > 0 ? lineIdParam.trim() : null\n\n  if (normalizedFrom && normalizedTo) {\n    const fromTime = new Date(`${normalizedFrom}T00:00:00Z`).getTime()\n    const toTime = new Date(`${normalizedTo}T23:59:59Z`).getTime()\n    if (Number.isFinite(fromTime) && Number.isFinite(toTime) && fromTime > toTime) {\n      const temp = normalizedFrom\n      normalizedFrom = normalizedTo\n      normalizedTo = temp\n    }\n  }\n\n  try {\n    const columnRows = await runQuery(`SHOW COLUMNS FROM \\`${tableName}\\``)\n    const columnNames = columnRows\n      .map((column) => column?.Field)\n      .filter((value) => typeof value === \"string\")\n\n    const lineIdColumn = normalizedLineId ? findColumn(columnNames, \"line_id\") : null\n    const userSdwtProdColumn = normalizedLineId ? findColumn(columnNames, \"user_sdwt_prod\") : null\n    const dateColumn =\n      (normalizedFrom || normalizedTo) &&\n      DATE_COLUMN_CANDIDATES.map((candidate) => findColumn(columnNames, candidate)).find(Boolean)\n\n    const filters = []\n    const params = []\n\n    let userSdwtProds = []\n    if (normalizedLineId && userSdwtProdColumn) {\n      const mappingRows = await runQuery(\n        `\n          SELECT DISTINCT user_sdwt_prod\n          FROM ${LINE_SDWT_TABLE_NAME}\n          WHERE line_id = ?\n            AND user_sdwt_prod IS NOT NULL\n            AND user_sdwt_prod <> ''\n        `,\n        [normalizedLineId]\n      )\n\n      userSdwtProds = Array.from(\n        new Set(\n          mappingRows\n            .map((row) => (typeof row?.user_sdwt_prod === \"string\" ? row.user_sdwt_prod.trim() : \"\"))\n            .filter((value) => value.length > 0)\n        )\n      )\n\n      if (userSdwtProds.length === 0) {\n        return NextResponse.json({\n          table: tableName,\n          from: normalizedFrom && dateColumn ? normalizedFrom : null,\n          to: normalizedTo && dateColumn ? normalizedTo : null,\n          rowCount: 0,\n          columns: columnNames,\n          rows: [],\n        })\n      }\n\n      filters.push(`\\`${userSdwtProdColumn}\\` IN (${userSdwtProds.map(() => \"?\").join(\", \")})`)\n      params.push(...userSdwtProds)\n    } else if (normalizedLineId && lineIdColumn) {\n      filters.push(`\\`${lineIdColumn}\\` = ?`)\n      params.push(normalizedLineId)\n    }\n\n    if (normalizedFrom && dateColumn) {\n      filters.push(`\\`${dateColumn}\\` >= ?`)\n      params.push(`${normalizedFrom} 00:00:00`)\n    }\n\n    if (normalizedTo && dateColumn) {\n      filters.push(`\\`${dateColumn}\\` <= ?`)\n      params.push(`${normalizedTo} 23:59:59`)\n    }\n\n    const whereClause = filters.length > 0 ? `WHERE ${filters.join(\" AND \")}` : \"\"\n\n    const orderColumn =\n      dateColumn ??\n      findColumn(columnNames, \"updated_at\") ??\n      findColumn(columnNames, \"created_at\") ??\n      findColumn(columnNames, \"id\")\n    const orderClause = orderColumn ? `ORDER BY \\`${orderColumn}\\` DESC` : \"\"\n\n    const limit = Math.max(1, Math.min(ROW_LIMIT, Number.parseInt(searchParams.get(\"limit\") ?? \"\", 10) || ROW_LIMIT))\n\n    const rows = await runQuery(\n      `\n        SELECT *\n        FROM \\`${tableName}\\`\n        ${whereClause}\n        ${orderClause}\n      `,\n      params\n    )\n\n    return NextResponse.json({\n      table: tableName,\n      from: normalizedFrom && dateColumn ? normalizedFrom : null,\n      to: normalizedTo && dateColumn ? normalizedTo : null,\n      rowCount: rows.length,\n      columns: columnNames,\n      rows,\n    })\n  } catch (error) {\n    if (error && typeof error === \"object\" && error.code === \"ER_NO_SUCH_TABLE\") {\n      return NextResponse.json({ error: `Table \"${tableName}\" was not found` }, { status: 404 })\n    }\n\n    console.error(\"Failed to load table data\", error)\n    return NextResponse.json({ error: \"Failed to load table data\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}