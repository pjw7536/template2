{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/lib/db.js"],"sourcesContent":["// src/lib/db.js\nimport mysql from \"mysql2/promise\"\n\nlet pool = null\n\nfunction getConfig() {\n  const host = process.env.DB_HOST ?? \"127.0.0.1\"\n  const port = Number.parseInt(process.env.DB_PORT ?? \"3307\", 10)\n  const user = process.env.DB_USER ?? \"drone_user\"\n  const password = process.env.DB_PASSWORD ?? \"dronepwd\"\n  const database = process.env.DB_NAME ?? \"drone_sop\"\n\n  return {\n    host,\n    port: Number.isNaN(port) ? 3307 : port,\n    user,\n    password,\n    database,\n  }\n}\n\nexport function getPool() {\n  if (!pool) {\n    const config = getConfig()\n    pool = mysql.createPool({\n      ...config,\n      waitForConnections: true,\n      connectionLimit: 10,\n      // ✅ 한국시간 (UTC+9)\n      timezone: \"+09:00\",\n    })\n  }\n  return pool\n}\n\nexport async function runQuery(sql, params = []) {\n  const currentPool = getPool()\n  const [rows] = await currentPool.query(sql, params)\n  return rows\n}\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;AAChB;;AAEA,IAAI,OAAO;AAEX,SAAS;IACP,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,MAAM,OAAO,OAAO,QAAQ,CAAC,QAAQ,GAAG,CAAC,OAAO,IAAI,QAAQ;IAC5D,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,MAAM,WAAW,QAAQ,GAAG,CAAC,WAAW,IAAI;IAC5C,MAAM,WAAW,QAAQ,GAAG,CAAC,OAAO,IAAI;IAExC,OAAO;QACL;QACA,MAAM,OAAO,KAAK,CAAC,QAAQ,OAAO;QAClC;QACA;QACA;IACF;AACF;AAEO,SAAS;IACd,IAAI,CAAC,MAAM;QACT,MAAM,SAAS;QACf,OAAO,8MAAK,CAAC,UAAU,CAAC;YACtB,GAAG,MAAM;YACT,oBAAoB;YACpB,iBAAiB;YACjB,iBAAiB;YACjB,UAAU;QACZ;IACF;IACA,OAAO;AACT;AAEO,eAAe,SAAS,GAAG,EAAE,SAAS,EAAE;IAC7C,MAAM,cAAc;IACpB,MAAM,CAAC,KAAK,GAAG,MAAM,YAAY,KAAK,CAAC,KAAK;IAC5C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/app/api/drone-early-inform-v3/route.js"],"sourcesContent":["// src/app/api/drone-early-inform-v3/route.js\nimport { NextResponse } from \"next/server\"\n\nimport { getPool, runQuery } from \"@/lib/db\"\n\nconst TABLE_NAME = \"drone_early_inform_v3\"\nconst SELECT_COLUMNS = [\"id\", \"line_id\", \"main_step\", \"custom_end_step\"]\n\nfunction normalizeLineId(value) {\n  if (typeof value !== \"string\") return null\n  const trimmed = value.trim()\n  return trimmed.length > 0 ? trimmed : null\n}\n\nfunction normalizeStep(value) {\n  if (typeof value !== \"string\") return null\n  const trimmed = value.trim()\n  return trimmed.length > 0 ? trimmed : null\n}\n\nfunction normalizeOptionalStep(value) {\n  if (value === null || value === undefined) return null\n  if (typeof value !== \"string\") return String(value)\n  const trimmed = value.trim()\n  return trimmed.length > 0 ? trimmed : null\n}\n\nexport async function GET(request) {\n  const url = new URL(request.url)\n  const lineIdParam = url.searchParams.get(\"lineId\")\n  const normalizedLineId = normalizeLineId(lineIdParam)\n\n  try {\n    const params = []\n    const where = []\n\n    if (normalizedLineId) {\n      where.push(\"`line_id` = ?\")\n      params.push(normalizedLineId)\n    }\n\n    const whereClause = where.length ? `WHERE ${where.join(\" AND \")}` : \"\"\n    const rows = await runQuery(\n      `\n        SELECT ${SELECT_COLUMNS.map((column) => `\\`${column}\\``).join(\", \")}\n        FROM \\`${TABLE_NAME}\\`\n        ${whereClause}\n        ORDER BY \\`line_id\\` ASC, \\`main_step\\` ASC, \\`id\\` ASC\n      `,\n      params\n    )\n\n    return NextResponse.json({\n      rows,\n      lineId: normalizedLineId,\n      count: rows.length,\n    })\n  } catch (error) {\n    console.error(\"Failed to load drone_early_inform_v3 rows\", error)\n    return NextResponse.json({ error: \"Failed to load table data\" }, { status: 500 })\n  }\n}\n\nexport async function POST(request) {\n  let payload\n  try {\n    payload = await request.json()\n  } catch {\n    return NextResponse.json({ error: \"Invalid JSON body\" }, { status: 400 })\n  }\n\n  const lineId = normalizeLineId(payload?.line_id ?? payload?.lineId)\n  const mainStep = normalizeStep(payload?.main_step ?? payload?.mainStep)\n  const customEndStep = normalizeOptionalStep(payload?.custom_end_step ?? payload?.customEndStep)\n\n  if (!lineId) {\n    return NextResponse.json({ error: \"line_id is required\" }, { status: 400 })\n  }\n\n  if (!mainStep) {\n    return NextResponse.json({ error: \"main_step is required\" }, { status: 400 })\n  }\n\n  try {\n    const pool = getPool()\n    const [result] = await pool.execute(\n      `\n        INSERT INTO \\`${TABLE_NAME}\\` (\\`line_id\\`, \\`main_step\\`, \\`custom_end_step\\`)\n        VALUES (?, ?, ?)\n      `,\n      [lineId, mainStep, customEndStep]\n    )\n\n    const insertedId = result?.insertId\n    if (!insertedId) {\n      return NextResponse.json({ error: \"Failed to insert row\" }, { status: 500 })\n    }\n\n    const [insertedRow] = await runQuery(\n      `\n        SELECT ${SELECT_COLUMNS.map((column) => `\\`${column}\\``).join(\", \")}\n        FROM \\`${TABLE_NAME}\\`\n        WHERE \\`id\\` = ?\n        LIMIT 1\n      `,\n      [insertedId]\n    )\n\n    return NextResponse.json({ row: insertedRow }, { status: 201 })\n  } catch (error) {\n    if (error && typeof error === \"object\" && error.code === \"ER_DUP_ENTRY\") {\n      return NextResponse.json({ error: \"A record with the same line_id and main_step already exists\" }, { status: 409 })\n    }\n\n    console.error(\"Failed to insert drone_early_inform_v3 row\", error)\n    return NextResponse.json({ error: \"Failed to insert row\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}