{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/components/data-table/constants.js"],"sourcesContent":["export const DEFAULT_TABLE = \"drone_sop_v3\"\nexport const DEFAULT_SINCE_DAYS = 3\n\nconst DAY_IN_MS = 86_400_000\n\nexport const toDateInputValue = (date) => date.toISOString().split(\"T\")[0]\n\nexport const getDefaultSinceValue = () => {\n  const now = new Date()\n  const since = new Date(now.getTime() - DEFAULT_SINCE_DAYS * DAY_IN_MS)\n  return toDateInputValue(since)\n}\n\nexport const SAVING_DELAY_MS = 180\nexport const MIN_SAVING_VISIBLE_MS = 500\nexport const SAVED_VISIBLE_MS = 800\n\nexport const STEP_COLUMN_KEYS = [\n  \"main_step\",\n  \"metro_steps\",\n  \"metro_current_step\",\n  \"metro_end_step\",\n  \"custom_end_step\",\n  \"inform_step\",\n]\n\nexport const STEP_COLUMN_KEY_SET = new Set(STEP_COLUMN_KEYS)\n\nexport const numberFormatter = new Intl.NumberFormat(\"en-US\")\nexport const timeFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n  second: \"2-digit\",\n})\n\nexport const dateFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  year: \"numeric\",\n  month: \"2-digit\",\n  day: \"2-digit\",\n})\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAO,MAAM,gBAAgB;AACtB,MAAM,qBAAqB;AAElC,MAAM,YAAY;AAEX,MAAM,mBAAmB,CAAC,OAAS,KAAK,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;AAEnE,MAAM,uBAAuB;IAClC,MAAM,MAAM,IAAI;IAChB,MAAM,QAAQ,IAAI,KAAK,IAAI,OAAO,KAAK,qBAAqB;IAC5D,OAAO,iBAAiB;AAC1B;AAEO,MAAM,kBAAkB;AACxB,MAAM,wBAAwB;AAC9B,MAAM,mBAAmB;AAEzB,MAAM,mBAAmB;IAC9B;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,sBAAsB,IAAI,IAAI;AAEpC,MAAM,kBAAkB,IAAI,KAAK,YAAY,CAAC;AAC9C,MAAM,gBAAgB,IAAI,KAAK,cAAc,CAAC,SAAS;IAC5D,MAAM;IACN,QAAQ;IACR,QAAQ;AACV;AAEO,MAAM,gBAAgB,IAAI,KAAK,cAAc,CAAC,SAAS;IAC5D,MAAM;IACN,OAAO;IACP,KAAK;AACP","debugId":null}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/components/data-table/cells/comment-cell.jsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\n\nimport { Button } from \"@/components/ui/button\"\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\"\n\nexport function CommentCell({ meta, recordId, baseValue }) {\n  const isEditing = Boolean(meta.commentEditing[recordId])\n  const draftValue = meta.commentDrafts[recordId]\n  const value = isEditing ? draftValue ?? baseValue : baseValue\n  const isSaving = Boolean(meta.updatingCells[`${recordId}:comment`])\n  const errorMessage = meta.updateErrors[`${recordId}:comment`]\n  const indicator = meta.cellIndicators[`${recordId}:comment`]\n  const indicatorStatus = indicator?.status\n  const [showSuccessIndicator, setShowSuccessIndicator] = React.useState(false)\n  const successDismissTimerRef = React.useRef(null)\n\n  React.useEffect(() => {\n    if (!isEditing) {\n      setShowSuccessIndicator(false)\n      return\n    }\n\n    if (indicatorStatus === \"saving\") {\n      setShowSuccessIndicator(false)\n      return\n    }\n\n    if (indicatorStatus === \"saved\") {\n      setShowSuccessIndicator(true)\n      if (successDismissTimerRef.current) {\n        window.clearTimeout(successDismissTimerRef.current)\n      }\n      successDismissTimerRef.current = window.setTimeout(() => {\n        meta.setCommentEditingState(recordId, false)\n        meta.removeCommentDraftValue(recordId)\n        meta.clearUpdateError(`${recordId}:comment`)\n        setShowSuccessIndicator(false)\n        successDismissTimerRef.current = null\n      }, 800)\n    }\n\n    return () => {\n      if (successDismissTimerRef.current) {\n        window.clearTimeout(successDismissTimerRef.current)\n        successDismissTimerRef.current = null\n      }\n    }\n  }, [indicatorStatus, isEditing, meta, recordId])\n\n  const handleSave = async () => {\n    const nextValue = draftValue ?? baseValue\n    if (nextValue === baseValue) {\n      meta.setCommentEditingState(recordId, false)\n      meta.removeCommentDraftValue(recordId)\n      return\n    }\n    const success = await meta.handleUpdate(recordId, { comment: nextValue })\n    if (!success) {\n      return\n    }\n  }\n\n  const handleCancel = () => {\n    if (successDismissTimerRef.current) {\n      window.clearTimeout(successDismissTimerRef.current)\n      successDismissTimerRef.current = null\n    }\n    setShowSuccessIndicator(false)\n    meta.setCommentEditingState(recordId, false)\n    meta.removeCommentDraftValue(recordId)\n    meta.clearUpdateError(`${recordId}:comment`)\n  }\n\n  const renderDialogStatusMessage = () => {\n    if (errorMessage) {\n      return <div className=\"text-xs text-destructive\">{errorMessage}</div>\n    }\n    if (indicatorStatus === \"saving\") {\n      return <div className=\"text-xs text-muted-foreground\">Saving…</div>\n    }\n    if (indicatorStatus === \"saved\" && showSuccessIndicator) {\n      return <div className=\"text-xs text-emerald-600\">Saved</div>\n    }\n    return null\n  }\n\n  return (\n    <div className=\"flex flex-col gap-1\">\n      <Dialog\n        open={isEditing}\n        onOpenChange={(nextOpen) => {\n          if (nextOpen) {\n            meta.setCommentDraftValue(recordId, baseValue)\n            meta.setCommentEditingState(recordId, true)\n          } else {\n            meta.setCommentEditingState(recordId, false)\n            meta.removeCommentDraftValue(recordId)\n          }\n          meta.clearUpdateError(`${recordId}:comment`)\n        }}\n      >\n        <DialogTrigger asChild>\n          <button\n            type=\"button\"\n            className=\"whitespace-pre-wrap break-words rounded-md border border-transparent px-2 py-1 text-left text-sm transition-colors hover:border-border hover:bg-muted focus:outline-hidden focus-visible:ring-2 focus-visible:ring-ring\"\n          >\n            {baseValue.length > 0 ? (\n              baseValue\n            ) : (\n              <span className=\"text-muted-foreground\">Tap to add a comment</span>\n            )}\n          </button>\n        </DialogTrigger>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Edit comment</DialogTitle>\n          </DialogHeader>\n          <textarea\n            value={value}\n            disabled={isSaving}\n            onChange={(event) => {\n              const nextValue = event.target.value\n              meta.setCommentDraftValue(recordId, nextValue)\n              meta.clearUpdateError(`${recordId}:comment`)\n            }}\n            className=\"min-h-[6rem] resize-y rounded-md border border-input bg-background px-2 py-1 text-sm focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring disabled:cursor-not-allowed\"\n            aria-label=\"Edit comment\"\n            autoFocus\n          />\n          {renderDialogStatusMessage()}\n          <DialogFooter>\n            <Button\n              onClick={() => {\n                void handleSave()\n              }}\n              disabled={isSaving}\n            >\n              Save\n            </Button>\n            <Button variant=\"outline\" onClick={handleCancel} disabled={isSaving}>\n              Cancel\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n      {/* Intentionally no inline status indicator. Status is shown within the dialog. */}\n    </div>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 305, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/components/ui/checkbox.jsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { CheckIcon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Checkbox({\n  className,\n  ...props\n}) {\n  return (\n    <CheckboxPrimitive.Root\n      data-slot=\"checkbox\"\n      className={cn(\n        \"peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}>\n      <CheckboxPrimitive.Indicator\n        data-slot=\"checkbox-indicator\"\n        className=\"grid place-content-center text-current transition-none\">\n        <CheckIcon className=\"size-3.5\" />\n      </CheckboxPrimitive.Indicator>\n    </CheckboxPrimitive.Root>\n  );\n}\n\nexport { Checkbox }\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAEA;AANA;;;;;;AAQA,SAAS,SAAS,EAChB,SAAS,EACT,GAAG,OACJ;IACC,qBACE,+cAAC,oVAAsB;QACrB,aAAU;QACV,WAAW,IAAA,qIAAE,EACX,+eACA;QAED,GAAG,KAAK;kBACT,cAAA,+cAAC,yVAA2B;YAC1B,aAAU;YACV,WAAU;sBACV,cAAA,+cAAC,qTAAS;gBAAC,WAAU;;;;;;;;;;;;;;;;AAI7B","debugId":null}},
    {"offset": {"line": 351, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/components/data-table/cells/need-to-send-cell.jsx"],"sourcesContent":["\"use client\"\n\nimport { Checkbox } from \"@/components/ui/checkbox\"\n\nexport function NeedToSendCell({ meta, recordId, baseValue }) {\n  const draftValue = meta.needToSendDrafts[recordId]\n  const nextValue = draftValue ?? baseValue\n  const isChecked = Number(nextValue) === 1\n  const isSaving = Boolean(meta.updatingCells[`${recordId}:needtosend`])\n  const errorMessage = meta.updateErrors[`${recordId}:needtosend`]\n  const indicator = meta.cellIndicators[`${recordId}:needtosend`]\n  const indicatorStatus = indicator?.status\n\n  return (\n    <div className=\"flex flex-col gap-1\">\n      <div className=\"flex items-center gap-2\">\n        <Checkbox\n          checked={isChecked}\n          onCheckedChange={async (checked) => {\n            const numericNext = checked === true ? 1 : 0\n            if (numericNext === baseValue) {\n              meta.removeNeedToSendDraftValue(recordId)\n              meta.clearUpdateError(`${recordId}:needtosend`)\n              return\n            }\n            meta.setNeedToSendDraftValue(recordId, numericNext)\n            meta.clearUpdateError(`${recordId}:needtosend`)\n            const success = await meta.handleUpdate(recordId, {\n              needtosend: numericNext,\n            })\n            if (!success) {\n              meta.removeNeedToSendDraftValue(recordId)\n            }\n          }}\n          disabled={isSaving}\n          aria-label=\"Toggle need to send\"\n        />\n        <div className=\"flex flex-row items-center gap-1 text-xs text-muted-foreground\">\n          {isChecked ? \"Yes\" : \"No\"}\n          {errorMessage ? (\n            <div className=\"text-xs text-destructive\">{errorMessage}</div>\n          ) : indicatorStatus === \"saving\" ? (\n            <div className=\"text-xs text-muted-foreground\">...</div>\n          ) : indicatorStatus === \"saved\" ? (\n            <div className=\"text-xs text-emerald-600\">✓</div>\n          ) : null}\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIO,SAAS,eAAe,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE;IAC1D,MAAM,aAAa,KAAK,gBAAgB,CAAC,SAAS;IAClD,MAAM,YAAY,cAAc;IAChC,MAAM,YAAY,OAAO,eAAe;IACxC,MAAM,WAAW,QAAQ,KAAK,aAAa,CAAC,GAAG,SAAS,WAAW,CAAC,CAAC;IACrE,MAAM,eAAe,KAAK,YAAY,CAAC,GAAG,SAAS,WAAW,CAAC,CAAC;IAChE,MAAM,YAAY,KAAK,cAAc,CAAC,GAAG,SAAS,WAAW,CAAC,CAAC;IAC/D,MAAM,kBAAkB,WAAW;IAEnC,qBACE,+cAAC;QAAI,WAAU;kBACb,cAAA,+cAAC;YAAI,WAAU;;8BACb,+cAAC,4JAAQ;oBACP,SAAS;oBACT,iBAAiB,OAAO;wBACtB,MAAM,cAAc,YAAY,OAAO,IAAI;wBAC3C,IAAI,gBAAgB,WAAW;4BAC7B,KAAK,0BAA0B,CAAC;4BAChC,KAAK,gBAAgB,CAAC,GAAG,SAAS,WAAW,CAAC;4BAC9C;wBACF;wBACA,KAAK,uBAAuB,CAAC,UAAU;wBACvC,KAAK,gBAAgB,CAAC,GAAG,SAAS,WAAW,CAAC;wBAC9C,MAAM,UAAU,MAAM,KAAK,YAAY,CAAC,UAAU;4BAChD,YAAY;wBACd;wBACA,IAAI,CAAC,SAAS;4BACZ,KAAK,0BAA0B,CAAC;wBAClC;oBACF;oBACA,UAAU;oBACV,cAAW;;;;;;8BAEb,+cAAC;oBAAI,WAAU;;wBACZ,YAAY,QAAQ;wBACpB,6BACC,+cAAC;4BAAI,WAAU;sCAA4B;;;;;mCACzC,oBAAoB,yBACtB,+cAAC;4BAAI,WAAU;sCAAgC;;;;;mCAC7C,oBAAoB,wBACtB,+cAAC;4BAAI,WAAU;sCAA2B;;;;;mCACxC;;;;;;;;;;;;;;;;;;AAKd","debugId":null}},
    {"offset": {"line": 446, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/components/data-table/utils.jsx"],"sourcesContent":["import { IconChevronRight } from \"@tabler/icons-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nimport { STEP_COLUMN_KEY_SET } from \"./constants\"\n\nfunction formatShortDateTime(date) {\n  const month = String(date.getMonth() + 1).padStart(2, \"0\")\n  const day = String(date.getDate()).padStart(2, \"0\")\n  const hours = String(date.getHours()).padStart(2, \"0\")\n  const minutes = String(date.getMinutes()).padStart(2, \"0\")\n  return `${month}/${day} ${hours}:${minutes}`\n}\n\nfunction tryParseDate(value) {\n  if (value instanceof Date) {\n    return Number.isNaN(value.getTime()) ? null : value\n  }\n  if (typeof value === \"string\") {\n    const trimmed = value.trim()\n    if (trimmed.length === 0) return null\n    const looksLikeDateTime = /\\d{4}-\\d{2}-\\d{2}[T\\s]\\d{2}:\\d{2}/.test(trimmed)\n    const looksLikeDateOnly = /\\d{4}-\\d{2}-\\d{2}$/.test(trimmed)\n    if (!looksLikeDateTime && !looksLikeDateOnly) return null\n    const parsed = new Date(trimmed)\n    return Number.isNaN(parsed.getTime()) ? null : parsed\n  }\n  return null\n}\n\nexport function formatCellValue(value) {\n  if (value === null || value === undefined) {\n    return <span className=\"text-muted-foreground\">NULL</span>\n  }\n  if (typeof value === \"boolean\") return value ? \"TRUE\" : \"FALSE\"\n  if (typeof value === \"number\" || typeof value === \"bigint\") return value.toString()\n  const parsedDate = tryParseDate(value)\n  if (parsedDate) return formatShortDateTime(parsedDate)\n  if (typeof value === \"string\") {\n    if (value.length === 0) {\n      return <span className=\"text-muted-foreground\">{\"\\\"\\\"\"}</span>\n    }\n    if (value.length > 120) {\n      return <span className=\"whitespace-pre-wrap break-all text-xs leading-relaxed\">{value}</span>\n    }\n    return value\n  }\n  try {\n    return JSON.stringify(value)\n  } catch {\n    return String(value)\n  }\n}\n\nexport function searchableValue(value) {\n  if (value === null || value === undefined) return \"\"\n  const parsedDate = tryParseDate(value)\n  if (parsedDate) {\n    const formatted = formatShortDateTime(parsedDate)\n    return `${formatted} ${parsedDate.toISOString()}`.toLowerCase()\n  }\n  if (typeof value === \"string\") return value.toLowerCase()\n  if (typeof value === \"number\" || typeof value === \"bigint\") return value.toString().toLowerCase()\n  if (typeof value === \"boolean\") return value ? \"true\" : \"false\"\n  try {\n    return JSON.stringify(value).toLowerCase()\n  } catch {\n    return String(value).toLowerCase()\n  }\n}\n\nexport function normalizeStepValue(value) {\n  if (value === null || value === undefined) return null\n  const normalized = String(value).trim()\n  return normalized.length > 0 ? normalized : null\n}\n\nexport function parseMetroSteps(value) {\n  if (Array.isArray(value)) {\n    return value\n      .map((part) => normalizeStepValue(part))\n      .filter((step) => Boolean(step))\n  }\n  if (typeof value === \"string\") {\n    return value\n      .split(\",\")\n      .map((part) => normalizeStepValue(part))\n      .filter((step) => Boolean(step))\n  }\n  const single = normalizeStepValue(value)\n  return single ? [single] : []\n}\n\nexport function renderMetroStepFlow(rowData) {\n  const mainStep = normalizeStepValue(rowData.main_step)\n  const metroSteps = parseMetroSteps(rowData.metro_steps)\n  const statusValue = normalizeStepValue(rowData.status)\n  const metroCurrentStep = normalizeStepValue(rowData.metro_current_step)\n  const metroEndStep = normalizeStepValue(rowData.metro_end_step)\n  const customEndStep = normalizeStepValue(rowData.custom_end_step)\n  const informStep = normalizeStepValue(rowData.inform_step)\n\n  const highlightStep =\n    statusValue === \"MAIN_COMPLETE\"\n      ? mainStep ?? metroCurrentStep ?? null\n      : metroCurrentStep ?? mainStep ?? null\n\n  const endStep = customEndStep ?? metroEndStep ?? null\n\n  const orderedSteps = []\n  if (mainStep) orderedSteps.push(mainStep)\n  if (metroSteps.length > 0) orderedSteps.push(...metroSteps)\n  if (informStep) orderedSteps.push(informStep)\n  if (endStep && !orderedSteps.includes(endStep)) orderedSteps.push(endStep)\n\n  const seen = new Set()\n  const steps = orderedSteps.filter((step) => {\n    if (seen.has(step)) {\n      return false\n    }\n    seen.add(step)\n    return true\n  })\n\n  if (steps.length === 0) {\n    return <span className=\"text-muted-foreground\">-</span>\n  }\n\n  return (\n    <div className=\"flex flex-wrap items-center gap-1\">\n      {steps.map((step, index) => {\n        const isHighlight = highlightStep ? step === highlightStep : false\n        const isEnd = endStep ? step === endStep : false\n        const pillClasses = cn(\n          \"rounded-full border px-2 py-0.5 text-xs font-medium leading-none\",\n          isHighlight\n            ? \"border-primary bg-blue-600 text-primary-foreground\"\n            : isEnd && !isHighlight\n              ? \"border-border bg-slate-800 text-muted-foreground\"\n              : \"border-border bg-white text-foreground\"\n        )\n\n        return (\n          <div key={`${step}-${index}`} className=\"flex items-center gap-1\">\n            {index > 0 ? <IconChevronRight className=\"size-4 shrink-0 text-muted-foreground\" /> : null}\n            <span className={pillClasses}>{step}</span>\n          </div>\n        )\n      })}\n    </div>\n  )\n}\n\nexport function shouldCombineStepColumns(columns) {\n  return columns.some((key) => STEP_COLUMN_KEY_SET.has(key) && (key === \"main_step\" || key === \"metro_steps\"))\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 648, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/components/data-table/column-defs.jsx"],"sourcesContent":["\"use client\"\n\nimport { STEP_COLUMN_KEY_SET } from \"./constants\"\nimport { CommentCell } from \"./cells/comment-cell\"\nimport { NeedToSendCell } from \"./cells/need-to-send-cell\"\nimport { formatCellValue, renderMetroStepFlow } from \"./utils\"\n\nexport function createColumnDefs(columns) {\n  const stepColumnsWithIndex = columns\n    .map((key, index) => ({ key, index }))\n    .filter(({ key }) => STEP_COLUMN_KEY_SET.has(key))\n\n  const shouldCombineSteps =\n    stepColumnsWithIndex.some(({ key }) => key === \"main_step\") ||\n    stepColumnsWithIndex.some(({ key }) => key === \"metro_steps\")\n\n  const baseColumnKeys = shouldCombineSteps\n    ? columns.filter((key) => !STEP_COLUMN_KEY_SET.has(key))\n    : [...columns]\n\n  const makeColumnDef = (colKey) => ({\n    id: colKey,\n    header: () => colKey,\n    accessorFn: (row) => row[colKey],\n    meta: {\n      isEditable: colKey === \"comment\" || colKey === \"needtosend\",\n    },\n    cell: (info) => {\n      const meta = info.table.options.meta\n\n      if (colKey === \"comment\") {\n        const rowData = info.row.original\n        const rawId = rowData?.id\n        if (!meta || rawId === undefined || rawId === null) {\n          return formatCellValue(info.getValue())\n        }\n        const recordId = String(rawId)\n        const baseValueRaw = rowData?.comment\n        const baseValue =\n          typeof baseValueRaw === \"string\"\n            ? baseValueRaw\n            : baseValueRaw == null\n              ? \"\"\n              : String(baseValueRaw)\n        return <CommentCell meta={meta} recordId={recordId} baseValue={baseValue} />\n      }\n\n      if (colKey === \"needtosend\") {\n        const rowData = info.row.original\n        const rawId = rowData?.id\n        if (!meta || rawId === undefined || rawId === null) {\n          return formatCellValue(info.getValue())\n        }\n        const recordId = String(rawId)\n        const baseValueRaw = rowData?.needtosend\n        const baseValue =\n          typeof baseValueRaw === \"number\"\n            ? baseValueRaw\n            : typeof baseValueRaw === \"string\"\n              ? Number.parseInt(baseValueRaw, 10) || 0\n              : Number(baseValueRaw) || 0\n        return <NeedToSendCell meta={meta} recordId={recordId} baseValue={baseValue} />\n      }\n\n      return formatCellValue(info.getValue())\n    },\n    enableSorting: colKey !== \"comment\",\n  })\n\n  const defs = baseColumnKeys.map((key) => makeColumnDef(key))\n\n  if (shouldCombineSteps) {\n    const insertionIndex = stepColumnsWithIndex.length\n      ? Math.min(...stepColumnsWithIndex.map(({ index }) => index))\n      : defs.length\n    const headerLabel = stepColumnsWithIndex[0]?.key ?? \"Step Flow\"\n    const stepColumnDef = {\n      id: \"metro_step_flow\",\n      header: () => headerLabel,\n      accessorFn: (row) => row[\"main_step\"] ?? row[\"metro_steps\"] ?? null,\n      cell: (info) => renderMetroStepFlow(info.row.original),\n      enableSorting: false,\n      meta: {\n        isEditable: false,\n      },\n    }\n    defs.splice(Math.min(Math.max(insertionIndex, 0), defs.length), 0, stepColumnDef)\n  }\n\n  return defs\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOO,SAAS,iBAAiB,OAAO;IACtC,MAAM,uBAAuB,QAC1B,GAAG,CAAC,CAAC,KAAK,QAAU,CAAC;YAAE;YAAK;QAAM,CAAC,GACnC,MAAM,CAAC,CAAC,EAAE,GAAG,EAAE,GAAK,mNAAmB,CAAC,GAAG,CAAC;IAE/C,MAAM,qBACJ,qBAAqB,IAAI,CAAC,CAAC,EAAE,GAAG,EAAE,GAAK,QAAQ,gBAC/C,qBAAqB,IAAI,CAAC,CAAC,EAAE,GAAG,EAAE,GAAK,QAAQ;IAEjD,MAAM,iBAAiB,qBACnB,QAAQ,MAAM,CAAC,CAAC,MAAQ,CAAC,mNAAmB,CAAC,GAAG,CAAC,QACjD;WAAI;KAAQ;IAEhB,MAAM,gBAAgB,CAAC,SAAW,CAAC;YACjC,IAAI;YACJ,QAAQ,IAAM;YACd,YAAY,CAAC,MAAQ,GAAG,CAAC,OAAO;YAChC,MAAM;gBACJ,YAAY,WAAW,aAAa,WAAW;YACjD;YACA,MAAM,CAAC;gBACL,MAAM,OAAO,KAAK,KAAK,CAAC,OAAO,CAAC,IAAI;gBAEpC,IAAI,WAAW,WAAW;oBACxB,MAAM,UAAU,KAAK,GAAG,CAAC,QAAQ;oBACjC,MAAM,QAAQ,SAAS;oBACvB,IAAI,CAAC,QAAQ,UAAU,aAAa,UAAU,MAAM;wBAClD,OAAO,IAAA,4MAAe,EAAC,KAAK,QAAQ;oBACtC;oBACA,MAAM,WAAW,OAAO;oBACxB,MAAM,eAAe,SAAS;oBAC9B,MAAM,YACJ,OAAO,iBAAiB,WACpB,eACA,gBAAgB,OACd,KACA,OAAO;oBACf,qBAAO,+cAAC,2NAAW;wBAAC,MAAM;wBAAM,UAAU;wBAAU,WAAW;;;;;;gBACjE;gBAEA,IAAI,WAAW,cAAc;oBAC3B,MAAM,UAAU,KAAK,GAAG,CAAC,QAAQ;oBACjC,MAAM,QAAQ,SAAS;oBACvB,IAAI,CAAC,QAAQ,UAAU,aAAa,UAAU,MAAM;wBAClD,OAAO,IAAA,4MAAe,EAAC,KAAK,QAAQ;oBACtC;oBACA,MAAM,WAAW,OAAO;oBACxB,MAAM,eAAe,SAAS;oBAC9B,MAAM,YACJ,OAAO,iBAAiB,WACpB,eACA,OAAO,iBAAiB,WACtB,OAAO,QAAQ,CAAC,cAAc,OAAO,IACrC,OAAO,iBAAiB;oBAChC,qBAAO,+cAAC,yOAAc;wBAAC,MAAM;wBAAM,UAAU;wBAAU,WAAW;;;;;;gBACpE;gBAEA,OAAO,IAAA,4MAAe,EAAC,KAAK,QAAQ;YACtC;YACA,eAAe,WAAW;QAC5B,CAAC;IAED,MAAM,OAAO,eAAe,GAAG,CAAC,CAAC,MAAQ,cAAc;IAEvD,IAAI,oBAAoB;QACtB,MAAM,iBAAiB,qBAAqB,MAAM,GAC9C,KAAK,GAAG,IAAI,qBAAqB,GAAG,CAAC,CAAC,EAAE,KAAK,EAAE,GAAK,UACpD,KAAK,MAAM;QACf,MAAM,cAAc,oBAAoB,CAAC,EAAE,EAAE,OAAO;QACpD,MAAM,gBAAgB;YACpB,IAAI;YACJ,QAAQ,IAAM;YACd,YAAY,CAAC,MAAQ,GAAG,CAAC,YAAY,IAAI,GAAG,CAAC,cAAc,IAAI;YAC/D,MAAM,CAAC,OAAS,IAAA,gNAAmB,EAAC,KAAK,GAAG,CAAC,QAAQ;YACrD,eAAe;YACf,MAAM;gBACJ,YAAY;YACd;QACF;QACA,KAAK,MAAM,CAAC,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,gBAAgB,IAAI,KAAK,MAAM,GAAG,GAAG;IACrE;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 745, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/components/data-table/global-filter.js"],"sourcesContent":["import { searchableValue } from \"./utils\"\n\nexport const createGlobalFilterFn = (columns) =>\n  (row, _columnId, filterValue) => {\n    if (!filterValue) return true\n    const lc = String(filterValue).toLowerCase()\n    return columns.some((key) => {\n      const value = row.original?.[key]\n      return searchableValue(value).includes(lc)\n    })\n  }\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,uBAAuB,CAAC,UACnC,CAAC,KAAK,WAAW;QACf,IAAI,CAAC,aAAa,OAAO;QACzB,MAAM,KAAK,OAAO,aAAa,WAAW;QAC1C,OAAO,QAAQ,IAAI,CAAC,CAAC;YACnB,MAAM,QAAQ,IAAI,QAAQ,EAAE,CAAC,IAAI;YACjC,OAAO,IAAA,4MAAe,EAAC,OAAO,QAAQ,CAAC;QACzC;IACF","debugId":null}},
    {"offset": {"line": 763, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/components/data-table/use-cell-indicators.js"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\n\nimport {\n  MIN_SAVING_VISIBLE_MS,\n  SAVED_VISIBLE_MS,\n  SAVING_DELAY_MS,\n} from \"./constants\"\n\nfunction clearAllTimers(timers) {\n  if (timers.savingDelay) clearTimeout(timers.savingDelay)\n  if (timers.transition) clearTimeout(timers.transition)\n  if (timers.savedCleanup) clearTimeout(timers.savedCleanup)\n}\n\nexport function useCellIndicators() {\n  const [cellIndicators, setCellIndicators] = React.useState({})\n  const cellIndicatorsRef = React.useRef(cellIndicators)\n  const indicatorTimersRef = React.useRef({})\n  const activeIndicatorKeysRef = React.useRef(new Set())\n\n  React.useEffect(() => {\n    cellIndicatorsRef.current = cellIndicators\n  }, [cellIndicators])\n\n  React.useEffect(() => {\n    const timersRef = indicatorTimersRef\n    const activeKeysRef = activeIndicatorKeysRef\n\n    return () => {\n      Object.values(timersRef.current).forEach(clearAllTimers)\n      timersRef.current = {}\n      activeKeysRef.current.clear()\n    }\n  }, [])\n\n  const getTimerEntry = React.useCallback((key) => {\n    const existing = indicatorTimersRef.current[key]\n    if (existing) return existing\n    const created = {}\n    indicatorTimersRef.current[key] = created\n    return created\n  }, [])\n\n  const clearTimer = React.useCallback((key, timerName) => {\n    const entry = indicatorTimersRef.current[key]\n    if (!entry) return\n    const timer = entry[timerName]\n    if (timer !== undefined) {\n      clearTimeout(timer)\n      delete entry[timerName]\n    }\n  }, [])\n\n  const removeIndicatorImmediate = React.useCallback((key, allowedStatuses) => {\n    setCellIndicators((prev) => {\n      const current = prev[key]\n      if (!current) return prev\n      if (allowedStatuses && !allowedStatuses.includes(current.status)) {\n        return prev\n      }\n      const next = { ...prev }\n      delete next[key]\n      return next\n    })\n  }, [])\n\n  const begin = React.useCallback(\n    (keys) => {\n      if (keys.length === 0) return\n\n      setCellIndicators((prev) => {\n        let next = null\n        keys.forEach((key) => {\n          if (key in prev) {\n            if (next === null) next = { ...prev }\n            delete next[key]\n          }\n        })\n        return next ?? prev\n      })\n\n      keys.forEach((key) => {\n        activeIndicatorKeysRef.current.add(key)\n        const timers = getTimerEntry(key)\n        clearTimer(key, \"savingDelay\")\n        clearTimer(key, \"transition\")\n        clearTimer(key, \"savedCleanup\")\n        timers.savingDelay = setTimeout(() => {\n          delete timers.savingDelay\n          if (!activeIndicatorKeysRef.current.has(key)) return\n          setCellIndicators((prev) => ({\n            ...prev,\n            [key]: { status: \"saving\", visibleSince: Date.now() },\n          }))\n        }, SAVING_DELAY_MS)\n      })\n    },\n    [clearTimer, getTimerEntry]\n  )\n\n  const finalize = React.useCallback(\n    (keys, outcome) => {\n      if (keys.length === 0) return\n      const now = Date.now()\n\n      keys.forEach((key) => {\n        activeIndicatorKeysRef.current.delete(key)\n        clearTimer(key, \"savingDelay\")\n        clearTimer(key, \"transition\")\n        clearTimer(key, \"savedCleanup\")\n        const timers = getTimerEntry(key)\n        const indicator = cellIndicatorsRef.current[key]\n\n        const runWithMinimumVisible = (task) => {\n          if (indicator && indicator.status === \"saving\") {\n            const elapsed = now - indicator.visibleSince\n            const wait = Math.max(0, MIN_SAVING_VISIBLE_MS - elapsed)\n            if (wait > 0) {\n              timers.transition = setTimeout(() => {\n                delete timers.transition\n                task()\n              }, wait)\n              return\n            }\n          }\n          task()\n        }\n\n        if (outcome === \"success\") {\n          runWithMinimumVisible(() => {\n            if (activeIndicatorKeysRef.current.has(key)) return\n            setCellIndicators((prev) => ({\n              ...prev,\n              [key]: { status: \"saved\", visibleSince: Date.now() },\n            }))\n            timers.savedCleanup = setTimeout(() => {\n              delete timers.savedCleanup\n              if (activeIndicatorKeysRef.current.has(key)) return\n              removeIndicatorImmediate(key, [\"saved\"])\n            }, SAVED_VISIBLE_MS)\n          })\n        } else {\n          runWithMinimumVisible(() => {\n            if (activeIndicatorKeysRef.current.has(key)) return\n            removeIndicatorImmediate(key, [\"saving\"])\n          })\n        }\n      })\n    },\n    [clearTimer, getTimerEntry, removeIndicatorImmediate]\n  )\n\n  return { cellIndicators, begin, finalize }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 928, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/components/data-table/use-data-table.js"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\n\nimport { DEFAULT_TABLE, getDefaultSinceValue } from \"./constants\"\nimport { useCellIndicators } from \"./use-cell-indicators\"\n\nfunction deleteKeys(record, keys) {\n  if (keys.length === 0) return record\n  let next = null\n  keys.forEach((key) => {\n    if (key in record) {\n      if (next === null) next = { ...record }\n      delete next[key]\n    }\n  })\n  return next ?? record\n}\n\nfunction removeKey(record, key) {\n  if (!(key in record)) return record\n  const next = { ...record }\n  delete next[key]\n  return next\n}\n\nfunction normalizeTablePayload(payload) {\n  if (!payload || typeof payload !== \"object\") {\n    return {\n      table: DEFAULT_TABLE,\n      since: getDefaultSinceValue(),\n      rowCount: 0,\n      columns: [],\n      rows: [],\n    }\n  }\n\n  const normalizedColumns = Array.isArray(payload.columns)\n    ? payload.columns.filter((value) => typeof value === \"string\")\n    : []\n\n  const normalizedRows = Array.isArray(payload.rows)\n    ? payload.rows\n        .filter((row) => row && typeof row === \"object\")\n        .map((row) => ({ ...row }))\n    : []\n\n  const rowCountRaw = Number(payload.rowCount)\n  const normalizedRowCount = Number.isFinite(rowCountRaw) ? rowCountRaw : normalizedRows.length\n\n  const normalizedSince =\n    typeof payload.since === \"string\"\n      ? payload.since\n      : payload.since === null\n        ? null\n        : null\n\n  const normalizedTable = typeof payload.table === \"string\" ? payload.table : null\n\n  return {\n    table: normalizedTable,\n    since: normalizedSince,\n    rowCount: normalizedRowCount,\n    columns: normalizedColumns,\n    rows: normalizedRows,\n  }\n}\n\nexport function useDataTableState({ lineId }) {\n  const [selectedTable, setSelectedTable] = React.useState(DEFAULT_TABLE)\n  const [columns, setColumns] = React.useState([])\n  const [rows, setRows] = React.useState([])\n  const [since, setSince] = React.useState(() => getDefaultSinceValue())\n  const [appliedSince, setAppliedSince] = React.useState(() => getDefaultSinceValue())\n  const [filter, setFilter] = React.useState(\"\")\n  const [sorting, setSorting] = React.useState([])\n  const [commentDrafts, setCommentDrafts] = React.useState({})\n  const [commentEditing, setCommentEditing] = React.useState({})\n  const [needToSendDrafts, setNeedToSendDrafts] = React.useState({})\n  const [updatingCells, setUpdatingCells] = React.useState({})\n  const [updateErrors, setUpdateErrors] = React.useState({})\n  const [isLoadingRows, setIsLoadingRows] = React.useState(false)\n  const [rowsError, setRowsError] = React.useState(null)\n  const [lastFetchedCount, setLastFetchedCount] = React.useState(0)\n\n  const rowsRequestRef = React.useRef(0)\n  const { cellIndicators, begin, finalize } = useCellIndicators()\n\n  const fetchRows = React.useCallback(async () => {\n    const requestId = ++rowsRequestRef.current\n    setIsLoadingRows(true)\n    setRowsError(null)\n\n    try {\n      const effectiveSince = since && since.length > 0 ? since : getDefaultSinceValue()\n      const params = new URLSearchParams({ table: selectedTable, since: effectiveSince })\n      if (lineId) params.set(\"lineId\", lineId)\n\n      const response = await fetch(`/api/tables?${params.toString()}`, { cache: \"no-store\" })\n      let payload = {}\n\n      try {\n        payload = await response.json()\n      } catch {\n        payload = {}\n      }\n\n      if (!response.ok) {\n        const message =\n          payload &&\n          typeof payload === \"object\" &&\n          \"error\" in payload &&\n          typeof payload.error === \"string\"\n            ? payload.error\n            : `Request failed with status ${response.status}`\n        throw new Error(message)\n      }\n\n      if (rowsRequestRef.current !== requestId) return\n\n      const {\n        columns: fetchedColumns,\n        rows: fetchedRows,\n        rowCount,\n        since: applied,\n        table,\n      } = normalizeTablePayload(payload)\n\n      setColumns(fetchedColumns)\n      setRows(fetchedRows)\n      setLastFetchedCount(rowCount)\n      setAppliedSince(applied)\n      setCommentDrafts({})\n      setCommentEditing({})\n      setNeedToSendDrafts({})\n\n      if (table && table !== selectedTable) {\n        setSelectedTable(table)\n      }\n    } catch (error) {\n      if (rowsRequestRef.current !== requestId) return\n      const message = error instanceof Error ? error.message : \"Failed to load table rows\"\n      setRowsError(message)\n      setColumns([])\n      setRows([])\n      setLastFetchedCount(0)\n    } finally {\n      if (rowsRequestRef.current === requestId) setIsLoadingRows(false)\n    }\n  }, [since, selectedTable, lineId])\n\n  React.useEffect(() => {\n    fetchRows()\n  }, [fetchRows])\n\n  const clearUpdateError = React.useCallback((key) => {\n    setUpdateErrors((prev) => removeKey(prev, key))\n  }, [])\n\n  const handleUpdate = React.useCallback(\n    async (recordId, updates) => {\n      const fields = Object.keys(updates)\n      if (!recordId || fields.length === 0) return false\n\n      const cellKeys = fields.map((field) => `${recordId}:${field}`)\n\n      setUpdatingCells((prev) => {\n        const next = { ...prev }\n        cellKeys.forEach((key) => {\n          next[key] = true\n        })\n        return next\n      })\n\n      setUpdateErrors((prev) => {\n        const next = { ...prev }\n        cellKeys.forEach((key) => {\n          if (key in next) delete next[key]\n        })\n        return next\n      })\n\n      begin(cellKeys)\n\n      let updateSucceeded = false\n\n      try {\n        const response = await fetch(\"/api/tables/update\", {\n          method: \"PATCH\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({\n            table: selectedTable,\n            id: recordId,\n            updates,\n          }),\n        })\n\n        let payload = {}\n        try {\n          payload = await response.json()\n        } catch {\n          payload = {}\n        }\n\n        if (!response.ok) {\n          const message =\n            payload &&\n            typeof payload === \"object\" &&\n            \"error\" in payload &&\n            typeof payload.error === \"string\"\n              ? payload.error\n              : `Failed to update (status ${response.status})`\n          throw new Error(message)\n        }\n\n        setRows((previousRows) =>\n          previousRows.map((row) => {\n            const rowId = String(row?.id ?? \"\")\n            if (rowId !== recordId) return row\n            return {\n              ...row,\n              ...updates,\n            }\n          })\n        )\n\n        if (\"comment\" in updates) {\n          setCommentDrafts((prev) => removeKey(prev, recordId))\n          setCommentEditing((prev) => removeKey(prev, recordId))\n        }\n\n        if (\"needtosend\" in updates) {\n          setNeedToSendDrafts((prev) => removeKey(prev, recordId))\n        }\n\n        updateSucceeded = true\n        return true\n      } catch (error) {\n        const message = error instanceof Error ? error.message : \"Failed to update\"\n\n        setUpdateErrors((prev) => {\n          const next = { ...prev }\n          cellKeys.forEach((key) => {\n            next[key] = message\n          })\n          return next\n        })\n\n        return false\n      } finally {\n        setUpdatingCells((prev) => deleteKeys(prev, cellKeys))\n        finalize(cellKeys, updateSucceeded ? \"success\" : \"error\")\n      }\n    },\n    [selectedTable, begin, finalize]\n  )\n\n  const setCommentEditingState = React.useCallback((recordId, editing) => {\n    if (!recordId) return\n    setCommentEditing((prev) => {\n      if (editing) {\n        return {\n          ...prev,\n          [recordId]: true,\n        }\n      }\n      return removeKey(prev, recordId)\n    })\n  }, [])\n\n  const setCommentDraftValue = React.useCallback((recordId, value) => {\n    if (!recordId) return\n    setCommentDrafts((prev) => ({\n      ...prev,\n      [recordId]: value,\n    }))\n  }, [])\n\n  const removeCommentDraftValue = React.useCallback((recordId) => {\n    if (!recordId) return\n    setCommentDrafts((prev) => removeKey(prev, recordId))\n  }, [])\n\n  const setNeedToSendDraftValue = React.useCallback((recordId, value) => {\n    if (!recordId) return\n    setNeedToSendDrafts((prev) => ({\n      ...prev,\n      [recordId]: value,\n    }))\n  }, [])\n\n  const removeNeedToSendDraftValue = React.useCallback((recordId) => {\n    if (!recordId) return\n    setNeedToSendDrafts((prev) => removeKey(prev, recordId))\n  }, [])\n\n  const tableMeta = React.useMemo(\n    () => ({\n      commentDrafts,\n      commentEditing,\n      needToSendDrafts,\n      updatingCells,\n      updateErrors,\n      cellIndicators,\n      clearUpdateError,\n      setCommentDraftValue,\n      removeCommentDraftValue,\n      setCommentEditingState,\n      setNeedToSendDraftValue,\n      removeNeedToSendDraftValue,\n      handleUpdate,\n    }),\n    [\n      commentDrafts,\n      commentEditing,\n      needToSendDrafts,\n      updatingCells,\n      updateErrors,\n      cellIndicators,\n      clearUpdateError,\n      setCommentDraftValue,\n      removeCommentDraftValue,\n      setCommentEditingState,\n      setNeedToSendDraftValue,\n      removeNeedToSendDraftValue,\n      handleUpdate,\n    ]\n  )\n\n  return {\n    selectedTable,\n    columns,\n    rows,\n    since,\n    setSince,\n    appliedSince,\n    filter,\n    setFilter,\n    sorting,\n    setSorting,\n    isLoadingRows,\n    rowsError,\n    lastFetchedCount,\n    fetchRows,\n    tableMeta,\n  }\n}\n"],"names":[],"mappings":";;;;AAEA;AAEA;AACA;AALA;;;;AAOA,SAAS,WAAW,MAAM,EAAE,IAAI;IAC9B,IAAI,KAAK,MAAM,KAAK,GAAG,OAAO;IAC9B,IAAI,OAAO;IACX,KAAK,OAAO,CAAC,CAAC;QACZ,IAAI,OAAO,QAAQ;YACjB,IAAI,SAAS,MAAM,OAAO;gBAAE,GAAG,MAAM;YAAC;YACtC,OAAO,IAAI,CAAC,IAAI;QAClB;IACF;IACA,OAAO,QAAQ;AACjB;AAEA,SAAS,UAAU,MAAM,EAAE,GAAG;IAC5B,IAAI,CAAC,CAAC,OAAO,MAAM,GAAG,OAAO;IAC7B,MAAM,OAAO;QAAE,GAAG,MAAM;IAAC;IACzB,OAAO,IAAI,CAAC,IAAI;IAChB,OAAO;AACT;AAEA,SAAS,sBAAsB,OAAO;IACpC,IAAI,CAAC,WAAW,OAAO,YAAY,UAAU;QAC3C,OAAO;YACL,OAAO,6MAAa;YACpB,OAAO,IAAA,oNAAoB;YAC3B,UAAU;YACV,SAAS,EAAE;YACX,MAAM,EAAE;QACV;IACF;IAEA,MAAM,oBAAoB,MAAM,OAAO,CAAC,QAAQ,OAAO,IACnD,QAAQ,OAAO,CAAC,MAAM,CAAC,CAAC,QAAU,OAAO,UAAU,YACnD,EAAE;IAEN,MAAM,iBAAiB,MAAM,OAAO,CAAC,QAAQ,IAAI,IAC7C,QAAQ,IAAI,CACT,MAAM,CAAC,CAAC,MAAQ,OAAO,OAAO,QAAQ,UACtC,GAAG,CAAC,CAAC,MAAQ,CAAC;YAAE,GAAG,GAAG;QAAC,CAAC,KAC3B,EAAE;IAEN,MAAM,cAAc,OAAO,QAAQ,QAAQ;IAC3C,MAAM,qBAAqB,OAAO,QAAQ,CAAC,eAAe,cAAc,eAAe,MAAM;IAE7F,MAAM,kBACJ,OAAO,QAAQ,KAAK,KAAK,WACrB,QAAQ,KAAK,GACb,QAAQ,KAAK,KAAK,OAChB,OACA;IAER,MAAM,kBAAkB,OAAO,QAAQ,KAAK,KAAK,WAAW,QAAQ,KAAK,GAAG;IAE5E,OAAO;QACL,OAAO;QACP,OAAO;QACP,UAAU;QACV,SAAS;QACT,MAAM;IACR;AACF;AAEO,SAAS,kBAAkB,EAAE,MAAM,EAAE;IAC1C,MAAM,CAAC,eAAe,iBAAiB,GAAG,kbAAc,CAAC,6MAAa;IACtE,MAAM,CAAC,SAAS,WAAW,GAAG,kbAAc,CAAC,EAAE;IAC/C,MAAM,CAAC,MAAM,QAAQ,GAAG,kbAAc,CAAC,EAAE;IACzC,MAAM,CAAC,OAAO,SAAS,GAAG,kbAAc,CAAC,IAAM,IAAA,oNAAoB;IACnE,MAAM,CAAC,cAAc,gBAAgB,GAAG,kbAAc,CAAC,IAAM,IAAA,oNAAoB;IACjF,MAAM,CAAC,QAAQ,UAAU,GAAG,kbAAc,CAAC;IAC3C,MAAM,CAAC,SAAS,WAAW,GAAG,kbAAc,CAAC,EAAE;IAC/C,MAAM,CAAC,eAAe,iBAAiB,GAAG,kbAAc,CAAC,CAAC;IAC1D,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,kbAAc,CAAC,CAAC;IAC5D,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,kbAAc,CAAC,CAAC;IAChE,MAAM,CAAC,eAAe,iBAAiB,GAAG,kbAAc,CAAC,CAAC;IAC1D,MAAM,CAAC,cAAc,gBAAgB,GAAG,kbAAc,CAAC,CAAC;IACxD,MAAM,CAAC,eAAe,iBAAiB,GAAG,kbAAc,CAAC;IACzD,MAAM,CAAC,WAAW,aAAa,GAAG,kbAAc,CAAC;IACjD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,kbAAc,CAAC;IAE/D,MAAM,iBAAiB,gbAAY,CAAC;IACpC,MAAM,EAAE,cAAc,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAA,iOAAiB;IAE7D,MAAM,YAAY,qbAAiB,CAAC;QAClC,MAAM,YAAY,EAAE,eAAe,OAAO;QAC1C,iBAAiB;QACjB,aAAa;QAEb,IAAI;YACF,MAAM,iBAAiB,SAAS,MAAM,MAAM,GAAG,IAAI,QAAQ,IAAA,oNAAoB;YAC/E,MAAM,SAAS,IAAI,gBAAgB;gBAAE,OAAO;gBAAe,OAAO;YAAe;YACjF,IAAI,QAAQ,OAAO,GAAG,CAAC,UAAU;YAEjC,MAAM,WAAW,MAAM,MAAM,CAAC,YAAY,EAAE,OAAO,QAAQ,IAAI,EAAE;gBAAE,OAAO;YAAW;YACrF,IAAI,UAAU,CAAC;YAEf,IAAI;gBACF,UAAU,MAAM,SAAS,IAAI;YAC/B,EAAE,OAAM;gBACN,UAAU,CAAC;YACb;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,UACJ,WACA,OAAO,YAAY,YACnB,WAAW,WACX,OAAO,QAAQ,KAAK,KAAK,WACrB,QAAQ,KAAK,GACb,CAAC,2BAA2B,EAAE,SAAS,MAAM,EAAE;gBACrD,MAAM,IAAI,MAAM;YAClB;YAEA,IAAI,eAAe,OAAO,KAAK,WAAW;YAE1C,MAAM,EACJ,SAAS,cAAc,EACvB,MAAM,WAAW,EACjB,QAAQ,EACR,OAAO,OAAO,EACd,KAAK,EACN,GAAG,sBAAsB;YAE1B,WAAW;YACX,QAAQ;YACR,oBAAoB;YACpB,gBAAgB;YAChB,iBAAiB,CAAC;YAClB,kBAAkB,CAAC;YACnB,oBAAoB,CAAC;YAErB,IAAI,SAAS,UAAU,eAAe;gBACpC,iBAAiB;YACnB;QACF,EAAE,OAAO,OAAO;YACd,IAAI,eAAe,OAAO,KAAK,WAAW;YAC1C,MAAM,UAAU,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YACzD,aAAa;YACb,WAAW,EAAE;YACb,QAAQ,EAAE;YACV,oBAAoB;QACtB,SAAU;YACR,IAAI,eAAe,OAAO,KAAK,WAAW,iBAAiB;QAC7D;IACF,GAAG;QAAC;QAAO;QAAe;KAAO;IAEjC,mbAAe,CAAC;QACd;IACF,GAAG;QAAC;KAAU;IAEd,MAAM,mBAAmB,qbAAiB,CAAC,CAAC;QAC1C,gBAAgB,CAAC,OAAS,UAAU,MAAM;IAC5C,GAAG,EAAE;IAEL,MAAM,eAAe,qbAAiB,CACpC,OAAO,UAAU;QACf,MAAM,SAAS,OAAO,IAAI,CAAC;QAC3B,IAAI,CAAC,YAAY,OAAO,MAAM,KAAK,GAAG,OAAO;QAE7C,MAAM,WAAW,OAAO,GAAG,CAAC,CAAC,QAAU,GAAG,SAAS,CAAC,EAAE,OAAO;QAE7D,iBAAiB,CAAC;YAChB,MAAM,OAAO;gBAAE,GAAG,IAAI;YAAC;YACvB,SAAS,OAAO,CAAC,CAAC;gBAChB,IAAI,CAAC,IAAI,GAAG;YACd;YACA,OAAO;QACT;QAEA,gBAAgB,CAAC;YACf,MAAM,OAAO;gBAAE,GAAG,IAAI;YAAC;YACvB,SAAS,OAAO,CAAC,CAAC;gBAChB,IAAI,OAAO,MAAM,OAAO,IAAI,CAAC,IAAI;YACnC;YACA,OAAO;QACT;QAEA,MAAM;QAEN,IAAI,kBAAkB;QAEtB,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,sBAAsB;gBACjD,QAAQ;gBACR,SAAS;oBACP,gBAAgB;gBAClB;gBACA,MAAM,KAAK,SAAS,CAAC;oBACnB,OAAO;oBACP,IAAI;oBACJ;gBACF;YACF;YAEA,IAAI,UAAU,CAAC;YACf,IAAI;gBACF,UAAU,MAAM,SAAS,IAAI;YAC/B,EAAE,OAAM;gBACN,UAAU,CAAC;YACb;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,UACJ,WACA,OAAO,YAAY,YACnB,WAAW,WACX,OAAO,QAAQ,KAAK,KAAK,WACrB,QAAQ,KAAK,GACb,CAAC,yBAAyB,EAAE,SAAS,MAAM,CAAC,CAAC,CAAC;gBACpD,MAAM,IAAI,MAAM;YAClB;YAEA,QAAQ,CAAC,eACP,aAAa,GAAG,CAAC,CAAC;oBAChB,MAAM,QAAQ,OAAO,KAAK,MAAM;oBAChC,IAAI,UAAU,UAAU,OAAO;oBAC/B,OAAO;wBACL,GAAG,GAAG;wBACN,GAAG,OAAO;oBACZ;gBACF;YAGF,IAAI,aAAa,SAAS;gBACxB,iBAAiB,CAAC,OAAS,UAAU,MAAM;gBAC3C,kBAAkB,CAAC,OAAS,UAAU,MAAM;YAC9C;YAEA,IAAI,gBAAgB,SAAS;gBAC3B,oBAAoB,CAAC,OAAS,UAAU,MAAM;YAChD;YAEA,kBAAkB;YAClB,OAAO;QACT,EAAE,OAAO,OAAO;YACd,MAAM,UAAU,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAEzD,gBAAgB,CAAC;gBACf,MAAM,OAAO;oBAAE,GAAG,IAAI;gBAAC;gBACvB,SAAS,OAAO,CAAC,CAAC;oBAChB,IAAI,CAAC,IAAI,GAAG;gBACd;gBACA,OAAO;YACT;YAEA,OAAO;QACT,SAAU;YACR,iBAAiB,CAAC,OAAS,WAAW,MAAM;YAC5C,SAAS,UAAU,kBAAkB,YAAY;QACnD;IACF,GACA;QAAC;QAAe;QAAO;KAAS;IAGlC,MAAM,yBAAyB,qbAAiB,CAAC,CAAC,UAAU;QAC1D,IAAI,CAAC,UAAU;QACf,kBAAkB,CAAC;YACjB,IAAI,SAAS;gBACX,OAAO;oBACL,GAAG,IAAI;oBACP,CAAC,SAAS,EAAE;gBACd;YACF;YACA,OAAO,UAAU,MAAM;QACzB;IACF,GAAG,EAAE;IAEL,MAAM,uBAAuB,qbAAiB,CAAC,CAAC,UAAU;QACxD,IAAI,CAAC,UAAU;QACf,iBAAiB,CAAC,OAAS,CAAC;gBAC1B,GAAG,IAAI;gBACP,CAAC,SAAS,EAAE;YACd,CAAC;IACH,GAAG,EAAE;IAEL,MAAM,0BAA0B,qbAAiB,CAAC,CAAC;QACjD,IAAI,CAAC,UAAU;QACf,iBAAiB,CAAC,OAAS,UAAU,MAAM;IAC7C,GAAG,EAAE;IAEL,MAAM,0BAA0B,qbAAiB,CAAC,CAAC,UAAU;QAC3D,IAAI,CAAC,UAAU;QACf,oBAAoB,CAAC,OAAS,CAAC;gBAC7B,GAAG,IAAI;gBACP,CAAC,SAAS,EAAE;YACd,CAAC;IACH,GAAG,EAAE;IAEL,MAAM,6BAA6B,qbAAiB,CAAC,CAAC;QACpD,IAAI,CAAC,UAAU;QACf,oBAAoB,CAAC,OAAS,UAAU,MAAM;IAChD,GAAG,EAAE;IAEL,MAAM,YAAY,ibAAa,CAC7B,IAAM,CAAC;YACL;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;QACF,CAAC,GACD;QACE;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAGH,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF","debugId":null}},
    {"offset": {"line": 1232, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/components/data-table/data-table.jsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport {\n  flexRender,\n  getCoreRowModel,\n  getFilteredRowModel,\n  getPaginationRowModel,\n  getSortedRowModel,\n  useReactTable,\n} from \"@tanstack/react-table\"\nimport {\n  IconAlertCircle,\n  IconChevronDown,\n  IconChevronUp,\n  IconDatabase,\n  IconLoader,\n  IconReload,\n} from \"@tabler/icons-react\"\n\n\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\"\n\nimport {\n  dateFormatter,\n  numberFormatter,\n  timeFormatter,\n  toDateInputValue,\n} from \"./constants\"\nimport { cn } from \"@/lib/utils\"\n\nimport { createColumnDefs } from \"./column-defs\"\nimport { createGlobalFilterFn } from \"./global-filter\"\nimport { useDataTableState } from \"./use-data-table\"\n\nexport function DataTable({ lineId }) {\n  const {\n    selectedTable,\n    columns,\n    rows,\n    since,\n    setSince,\n    appliedSince,\n    filter,\n    setFilter,\n    sorting,\n    setSorting,\n    isLoadingRows,\n    rowsError,\n    lastFetchedCount,\n    fetchRows,\n    tableMeta,\n  } = useDataTableState({ lineId })\n\n  const columnDefs = React.useMemo(() => createColumnDefs(columns), [columns])\n  const globalFilterFn = React.useMemo(() => createGlobalFilterFn(columns), [columns])\n\n  // eslint-disable-next-line react-hooks/incompatible-library\n  const table = useReactTable({\n    data: rows,\n    columns: columnDefs,\n    meta: tableMeta,\n    state: {\n      sorting,\n      globalFilter: filter,\n    },\n    onSortingChange: setSorting,\n    onGlobalFilterChange: setFilter,\n    globalFilterFn,\n    getCoreRowModel: getCoreRowModel(),\n    getFilteredRowModel: getFilteredRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    getPaginationRowModel: getPaginationRowModel(),\n    columnResizeMode: \"onChange\",\n  })\n\n  const emptyStateColSpan = Math.max(table.getVisibleLeafColumns().length, 1)\n  const totalLoaded = rows.length\n  const hasNoRows = !isLoadingRows && rowsError === null && columns.length === 0\n  const sinceLabel = appliedSince\n    ? dateFormatter.format(new Date(`${appliedSince}T00:00:00Z`))\n    : \"all time\"\n  const [lastUpdatedLabel, setLastUpdatedLabel] = React.useState(null)\n\n  React.useEffect(() => {\n    if (isLoadingRows) return\n    setLastUpdatedLabel(timeFormatter.format(new Date()))\n  }, [isLoadingRows])\n\n  return (\n    <section className=\"flex flex-col gap-2 px-4 lg:px-6\">\n      <div className=\"flex flex-wrap items-start justify-between gap-4\">\n        <div className=\"flex flex-col gap-1\">\n          <div className=\"flex items-center gap-2 text-lg font-semibold\">\n            <IconDatabase className=\"size-5\" />\n            데이터 테이블 · {lineId}\n          </div>\n          <p className=\"text-sm text-muted-foreground\">\n            Loaded {numberFormatter.format(totalLoaded)} rows from {selectedTable} (since {sinceLabel}).\n          </p>\n        </div>\n      </div>\n\n      <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\n        <Input\n          placeholder=\"Filter rows…\"\n          value={filter}\n          onChange={(event) => table.setGlobalFilter(event.target.value)}\n          className=\"sm:w-80\"\n          aria-label=\"Filter table rows\"\n        />\n\n        <div className=\"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center\">\n          <Input\n            type=\"date\"\n            max={toDateInputValue(new Date())}\n            value={since}\n            onChange={(event) => setSince(event.target.value)}\n            className=\"w-full sm:w-40\"\n            aria-label=\"Since date\"\n          />\n\n          <Button variant=\"outline\" onClick={() => void fetchRows()} disabled={isLoadingRows}>\n            {isLoadingRows ? <IconLoader className=\"mr-2 size-4 animate-spin\" /> : <IconReload className=\"mr-2 size-4\" />}\n            Refresh\n          </Button>\n        </div>\n      </div>\n\n      {rowsError ? (\n        <div className=\"flex items-center gap-2 rounded-lg border border-destructive/40 bg-destructive/10 px-4 py-3 text-sm text-destructive\">\n          <IconAlertCircle className=\"size-5 shrink-0\" />\n          <span>{rowsError}</span>\n        </div>\n      ) : null}\n\n      <TableContainer className=\"h-[600px] overflow-auto rounded-lg border\">\n        <Table className=\"min-w-max\" stickyHeader>\n          <TableHeader className=\"sticky top-0 z-10 bg-muted/40\">\n            {table.getHeaderGroups().map((headerGroup) => (\n              <TableRow key={headerGroup.id}>\n                {headerGroup.headers.map((header) => {\n                  const canSort = header.column.getCanSort()\n                  const sortDir = header.column.getIsSorted()\n                  return (\n                    <TableHead key={header.id} className=\"whitespace-nowrap\">\n                      {canSort ? (\n                        <button\n                          className=\"inline-flex items-center gap-1\"\n                          onClick={header.column.getToggleSortingHandler()}\n                        >\n                          {flexRender(header.column.columnDef.header, header.getContext())}\n                          {sortDir === \"asc\" && <IconChevronUp className=\"size-4\" />}\n                          {sortDir === \"desc\" && <IconChevronDown className=\"size-4\" />}\n                        </button>\n                      ) : (\n                        flexRender(header.column.columnDef.header, header.getContext())\n                      )}\n                      <span\n                        onMouseDown={header.getResizeHandler()}\n                        onTouchStart={header.getResizeHandler()}\n                        className=\"absolute right-0 top-0 h-full w-1 cursor-col-resize select-none touch-none\"\n                      />\n                    </TableHead>\n                  )\n                })}\n              </TableRow>\n            ))}\n          </TableHeader>\n\n          <TableBody>\n            {isLoadingRows ? (\n              <TableRow>\n                <TableCell colSpan={emptyStateColSpan} className=\"h-24 text-center text-sm text-muted-foreground\">\n                  Loading rows…\n                </TableCell>\n              </TableRow>\n            ) : rowsError ? (\n              <TableRow>\n                <TableCell colSpan={emptyStateColSpan} className=\"h-24 text-center text-sm text-destructive\">\n                  {rowsError}\n                </TableCell>\n              </TableRow>\n            ) : hasNoRows ? (\n              <TableRow>\n                <TableCell colSpan={emptyStateColSpan} className=\"h-24 text-center text-sm text-muted-foreground\">\n                  No rows returned.\n                </TableCell>\n              </TableRow>\n            ) : table.getRowModel().rows.length === 0 ? (\n              <TableRow>\n                <TableCell colSpan={emptyStateColSpan} className=\"h-24 text-center text-sm text-muted-foreground\">\n                  No rows match your filter.\n                </TableCell>\n              </TableRow>\n            ) : (\n              table.getRowModel().rows.map((row) => (\n                <TableRow key={row.id}>\n                  {row.getVisibleCells().map((cell) => {\n                    const isEditable = Boolean(cell.column.columnDef.meta?.isEditable)\n                    return (\n                      <TableCell\n                        key={cell.id}\n                        data-editable={isEditable ? \"true\" : \"false\"}\n                        className={cn(\n                          \"align-top\",\n                          !isEditable && \"caret-transparent focus:outline-none\"\n                        )}\n                      >\n                        {flexRender(cell.column.columnDef.cell, cell.getContext())}\n                      </TableCell>\n                    )\n                  })}\n                </TableRow>\n              ))\n            )}\n          </TableBody>\n        </Table>\n      </TableContainer>\n\n      <div className=\"flex flex-wrap items-center gap-1 justify-end text-xs text-muted-foreground\">\n        <span>Updated {isLoadingRows ? \"just now\" : lastUpdatedLabel ?? \"just now\"}</span>\n      </div>\n    </section>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}