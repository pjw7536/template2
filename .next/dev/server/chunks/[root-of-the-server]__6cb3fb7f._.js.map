{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/lib/db.js"],"sourcesContent":["import mysql from \"mysql2/promise\"\n\nlet pool = null\n\nfunction getConfig() {\n  const host = process.env.DB_HOST ?? \"127.0.0.1\"\n  const port = Number.parseInt(process.env.DB_PORT ?? \"3307\", 10)\n  const user = process.env.DB_USER ?? \"drone_user\"\n  const password = process.env.DB_PASSWORD ?? \"dronepwd\"\n  const database = process.env.DB_NAME ?? \"drone_sop\"\n\n  return {\n    host,\n    port: Number.isNaN(port) ? 3307 : port,\n    user,\n    password,\n    database,\n  }\n}\n\nexport function getPool() {\n  if (!pool) {\n    const config = getConfig()\n    pool = mysql.createPool({\n      ...config,\n      waitForConnections: true,\n      connectionLimit: 10,\n      // ✅ 한국시간 (UTC+9)\n      timezone: \"+09:00\",\n    })\n  }\n  return pool\n}\n\nexport async function runQuery(sql, params = []) {\n  const currentPool = getPool()\n  const [rows] = await currentPool.query(sql, params)\n  return rows\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,OAAO;AAEX,SAAS;IACP,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,MAAM,OAAO,OAAO,QAAQ,CAAC,QAAQ,GAAG,CAAC,OAAO,IAAI,QAAQ;IAC5D,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,MAAM,WAAW,QAAQ,GAAG,CAAC,WAAW,IAAI;IAC5C,MAAM,WAAW,QAAQ,GAAG,CAAC,OAAO,IAAI;IAExC,OAAO;QACL;QACA,MAAM,OAAO,KAAK,CAAC,QAAQ,OAAO;QAClC;QACA;QACA;IACF;AACF;AAEO,SAAS;IACd,IAAI,CAAC,MAAM;QACT,MAAM,SAAS;QACf,OAAO,8MAAK,CAAC,UAAU,CAAC;YACtB,GAAG,MAAM;YACT,oBAAoB;YACpB,iBAAiB;YACjB,iBAAiB;YACjB,UAAU;QACZ;IACF;IACA,OAAO;AACT;AAEO,eAAe,SAAS,GAAG,EAAE,SAAS,EAAE;IAC7C,MAAM,cAAc;IACpB,MAAM,CAAC,KAAK,GAAG,MAAM,YAAY,KAAK,CAAC,KAAK;IAC5C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 163, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/utils/transform-response.js"],"sourcesContent":["export function toISODate(input) {\n  if (!input) return null\n  const date = input instanceof Date ? input : new Date(String(input))\n  return Number.isNaN(date.getTime()) ? null : date.toISOString()\n}\n\nexport function normalizeLineId(raw) {\n  if (raw == null) return null\n  const value = String(raw).trim()\n  return value.length === 0 ? null : value\n}\n\nexport function mapSummaryRow(row) {\n  return {\n    totalCount: Number(row.totalCount ?? 0),\n    activeCount: Number(row.activeCount ?? 0),\n    completedCount: Number(row.completedCount ?? 0),\n    pendingJiraCount: Number(row.pendingJiraCount ?? 0),\n    lotCount: Number(row.lotCount ?? 0),\n    latestUpdatedAt: toISODate(row.latestUpdatedAt),\n  }\n}\n\nexport function mapTrendRows(rows) {\n  return rows.map((row) => ({\n    date: (toISODate(row.day) ?? \"\").slice(0, 10),\n    activeCount: Number(row.activeCount ?? 0),\n    completedCount: Number(row.completedCount ?? 0),\n  }))\n}\n\nexport function mapRecentRows(rows) {\n  return rows.map((row) => ({\n    id: row.id,\n    lotId: row.lot_id ?? null,\n    status: row.status ?? null,\n    createdAt: toISODate(row.created_at) ?? \"\",\n  }))\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAO,SAAS,UAAU,KAAK;IAC7B,IAAI,CAAC,OAAO,OAAO;IACnB,MAAM,OAAO,iBAAiB,OAAO,QAAQ,IAAI,KAAK,OAAO;IAC7D,OAAO,OAAO,KAAK,CAAC,KAAK,OAAO,MAAM,OAAO,KAAK,WAAW;AAC/D;AAEO,SAAS,gBAAgB,GAAG;IACjC,IAAI,OAAO,MAAM,OAAO;IACxB,MAAM,QAAQ,OAAO,KAAK,IAAI;IAC9B,OAAO,MAAM,MAAM,KAAK,IAAI,OAAO;AACrC;AAEO,SAAS,cAAc,GAAG;IAC/B,OAAO;QACL,YAAY,OAAO,IAAI,UAAU,IAAI;QACrC,aAAa,OAAO,IAAI,WAAW,IAAI;QACvC,gBAAgB,OAAO,IAAI,cAAc,IAAI;QAC7C,kBAAkB,OAAO,IAAI,gBAAgB,IAAI;QACjD,UAAU,OAAO,IAAI,QAAQ,IAAI;QACjC,iBAAiB,UAAU,IAAI,eAAe;IAChD;AACF;AAEO,SAAS,aAAa,IAAI;IAC/B,OAAO,KAAK,GAAG,CAAC,CAAC,MAAQ,CAAC;YACxB,MAAM,CAAC,UAAU,IAAI,GAAG,KAAK,EAAE,EAAE,KAAK,CAAC,GAAG;YAC1C,aAAa,OAAO,IAAI,WAAW,IAAI;YACvC,gBAAgB,OAAO,IAAI,cAAc,IAAI;QAC/C,CAAC;AACH;AAEO,SAAS,cAAc,IAAI;IAChC,OAAO,KAAK,GAAG,CAAC,CAAC,MAAQ,CAAC;YACxB,IAAI,IAAI,EAAE;YACV,OAAO,IAAI,MAAM,IAAI;YACrB,QAAQ,IAAI,MAAM,IAAI;YACtB,WAAW,UAAU,IAAI,UAAU,KAAK;QAC1C,CAAC;AACH","debugId":null}},
    {"offset": {"line": 214, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/api/line-dashboard.api.js"],"sourcesContent":["// src/features/line-dashboard/api/line-dashboard.api.js\nimport { runQuery } from \"@/lib/db\"\nimport {\n  mapRecentRows,\n  mapSummaryRow,\n  mapTrendRows,\n  normalizeLineId,\n} from \"../utils/transform-response\"\n\n/**\n * ---------------------------------------------------------------------------------------\n * 상수/환경\n * ---------------------------------------------------------------------------------------\n */\nconst DEFAULT_TABLE_NAME = \"drone_sop_v3\" // 기본 테이블명\nconst TREND_LOOKBACK_DAYS = 90 // 트렌드 조회 기간(일)\nconst RECENT_LIMIT = 10 // 최근 항목 개수\n\n/**\n * ---------------------------------------------------------------------------------------\n * SQL 템플릿\n * 식별자는 상수로, 값은 전부 바인딩\n * ---------------------------------------------------------------------------------------\n */\nconst SQL = {\n  summary: `\n    SELECT\n      COUNT(*) AS totalCount,\n      SUM(CASE WHEN status = 'Completed' THEN 1 ELSE 0 END) AS completedCount,\n      SUM(CASE WHEN status <> 'Completed' THEN 1 ELSE 0 END) AS activeCount,\n      SUM(CASE WHEN send_jira = 0 AND needtosend = 1 THEN 1 ELSE 0 END) AS pendingJiraCount,\n      COUNT(DISTINCT lot_id) AS lotCount,\n      MAX(updated_at) AS latestUpdatedAt\n    FROM ${DEFAULT_TABLE_NAME}\n    WHERE line_id = ?\n  `,\n  trend: `\n    SELECT\n      DATE(created_at) AS day,\n      SUM(CASE WHEN status = 'Completed' THEN 1 ELSE 0 END) AS completedCount,\n      SUM(CASE WHEN status <> 'Completed' THEN 1 ELSE 0 END) AS activeCount\n    FROM ${DEFAULT_TABLE_NAME}\n    WHERE line_id = ?\n      AND created_at IS NOT NULL\n      AND created_at >= DATE_SUB(CURDATE(), INTERVAL ? DAY)\n    GROUP BY DATE(created_at)\n    ORDER BY day ASC\n  `,\n  recent: `\n    SELECT\n      id, lot_id, status, created_at\n    FROM ${DEFAULT_TABLE_NAME}\n    WHERE line_id = ?\n    ORDER BY created_at DESC\n    LIMIT ?\n  `,\n}\n\n/**\n * ---------------------------------------------------------------------------------------\n * 메인 서비스 함수\n * ---------------------------------------------------------------------------------------\n */\nexport async function getLineDashboard(lineIdRaw) {\n  const lineId = normalizeLineId(lineIdRaw)\n  if (!lineId) {\n    throw new Error(\"lineId가 비어있습니다.\")\n  }\n\n  // 1) 요약 데이터 조회\n  const [summaryRow] = await runQuery(SQL.summary, [lineId])\n\n  const total = Number(summaryRow?.totalCount ?? 0)\n  if (!summaryRow || total === 0) {\n    return null\n  }\n\n  // 2) 트렌드 + 최근 목록 병렬 조회 (성능 향상)\n  const [trendRows, recentRows] = await Promise.all([\n    runQuery(SQL.trend, [lineId, TREND_LOOKBACK_DAYS]),\n    runQuery(SQL.recent, [lineId, RECENT_LIMIT]),\n  ])\n\n  return {\n    lineId,\n    summary: mapSummaryRow(summaryRow),\n    trend: mapTrendRows(trendRows),\n    recent: mapRecentRows(recentRows),\n  }\n}\n\nconst LINE_SDWT_TABLE_NAME = \"line_sdwt\"\n\nexport async function getDistinctLineIds() {\n  const rows = await runQuery(\n    `\n      SELECT DISTINCT line_id\n      FROM ${LINE_SDWT_TABLE_NAME}\n      WHERE line_id IS NOT NULL AND line_id <> ''\n      ORDER BY line_id\n    `\n  )\n\n  return rows\n    .map((row) => row.line_id)\n    .filter((lineId) => typeof lineId === \"string\" && lineId.length > 0)\n}\n"],"names":[],"mappings":"AAAA,wDAAwD;;;;;;;AACxD;AACA;;;AAOA;;;;CAIC,GACD,MAAM,qBAAqB,eAAe,UAAU;;AACpD,MAAM,sBAAsB,GAAG,eAAe;;AAC9C,MAAM,eAAe,GAAG,WAAW;;AAEnC;;;;;CAKC,GACD,MAAM,MAAM;IACV,SAAS,CAAC;;;;;;;;SAQH,EAAE,mBAAmB;;EAE5B,CAAC;IACD,OAAO,CAAC;;;;;SAKD,EAAE,mBAAmB;;;;;;EAM5B,CAAC;IACD,QAAQ,CAAC;;;SAGF,EAAE,mBAAmB;;;;EAI5B,CAAC;AACH;AAOO,eAAe,iBAAiB,SAAS;IAC9C,MAAM,SAAS,IAAA,uMAAe,EAAC;IAC/B,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IAEA,eAAe;IACf,MAAM,CAAC,WAAW,GAAG,MAAM,IAAA,0IAAQ,EAAC,IAAI,OAAO,EAAE;QAAC;KAAO;IAEzD,MAAM,QAAQ,OAAO,YAAY,cAAc;IAC/C,IAAI,CAAC,cAAc,UAAU,GAAG;QAC9B,OAAO;IACT;IAEA,+BAA+B;IAC/B,MAAM,CAAC,WAAW,WAAW,GAAG,MAAM,QAAQ,GAAG,CAAC;QAChD,IAAA,0IAAQ,EAAC,IAAI,KAAK,EAAE;YAAC;YAAQ;SAAoB;QACjD,IAAA,0IAAQ,EAAC,IAAI,MAAM,EAAE;YAAC;YAAQ;SAAa;KAC5C;IAED,OAAO;QACL;QACA,SAAS,IAAA,qMAAa,EAAC;QACvB,OAAO,IAAA,oMAAY,EAAC;QACpB,QAAQ,IAAA,qMAAa,EAAC;IACxB;AACF;AAEA,MAAM,uBAAuB;AAEtB,eAAe;IACpB,MAAM,OAAO,MAAM,IAAA,0IAAQ,EACzB,CAAC;;WAEM,EAAE,qBAAqB;;;IAG9B,CAAC;IAGH,OAAO,KACJ,GAAG,CAAC,CAAC,MAAQ,IAAI,OAAO,EACxB,MAAM,CAAC,CAAC,SAAW,OAAO,WAAW,YAAY,OAAO,MAAM,GAAG;AACtE","debugId":null}},
    {"offset": {"line": 318, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/features/line-dashboard/api/index.js"],"sourcesContent":["export { getLineDashboard, getDistinctLineIds } from \"./line-dashboard.api\"\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 325, "column": 0}, "map": {"version":3,"sources":["file:///home/pjw75/tailwind/src/app/api/line-dashboard/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\"\n\nimport { getLineDashboard } from \"@/features/line-dashboard/api\"\n\nexport async function GET(request) {\n  const { searchParams } = new URL(request.url)\n  const lineId = searchParams.get(\"lineId\")\n\n  if (!lineId) {\n    return NextResponse.json({ error: \"lineId is required\" }, { status: 400 })\n  }\n\n  try {\n    const data = await getLineDashboard(lineId)\n    if (!data) {\n      return NextResponse.json({ data: null }, { status: 404 })\n    }\n    return NextResponse.json(data)\n  } catch (error) {\n    const message = error instanceof Error ? error.message : \"Failed to load line dashboard\"\n    return NextResponse.json({ error: message }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AAEA;AAAA;;;AAEO,eAAe,IAAI,OAAO;IAC/B,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,SAAS,aAAa,GAAG,CAAC;IAEhC,IAAI,CAAC,QAAQ;QACX,OAAO,iXAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAqB,GAAG;YAAE,QAAQ;QAAI;IAC1E;IAEA,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,yMAAgB,EAAC;QACpC,IAAI,CAAC,MAAM;YACT,OAAO,iXAAY,CAAC,IAAI,CAAC;gBAAE,MAAM;YAAK,GAAG;gBAAE,QAAQ;YAAI;QACzD;QACA,OAAO,iXAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,MAAM,UAAU,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACzD,OAAO,iXAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC7D;AACF","debugId":null}}]
}